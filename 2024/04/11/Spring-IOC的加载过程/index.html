<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Spring-IOC | æ£®</title>
  <meta name="keywords" content=" spring ">
  <meta name="description" content="Spring-IOC | æ£®">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="description" content="æ½®èµ·æ½®è½ï¼Œäº‘å·äº‘èˆ’">
<meta property="og:type" content="website">
<meta property="og:title" content="all-tags">
<meta property="og:url" content="http://example.com/all-tags/index.html">
<meta property="og:site_name" content="æ£®">
<meta property="og:description" content="æ½®èµ·æ½®è½ï¼Œäº‘å·äº‘èˆ’">
<meta property="og:locale" content="zh_CH">
<meta property="article:published_time" content="2023-04-12T03:28:50.336Z">
<meta property="article:modified_time" content="2023-04-12T03:28:48.541Z">
<meta property="article:author" content="CSEN">
<meta name="twitter:card" content="summary">


<link rel="icon" href="/img/cs.jpg">

<link href="/css/style.css?v=1.1.0" rel="stylesheet">

<link href="/css/hl_theme/atom-light.css?v=1.1.0" rel="stylesheet">

<link href="//cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css" rel="stylesheet">

<script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="/js/titleTip.js?v=1.1.0" ></script>

<script src="//cdn.jsdelivr.net/npm/highlightjs@9.16.2/highlight.pack.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>

<script src="//cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>



<script src="//cdn.jsdelivr.net/npm/jquery.cookie@1.4.1/jquery.cookie.min.js" ></script>

<script src="/js/iconfont.js?v=1.1.0" ></script>

<meta name="generator" content="Hexo 6.3.0"></head>
<div style="display: none">
  <input class="theme_disqus_on" value="false">
  <input class="theme_preload_comment" value="">
  <input class="theme_blog_path" value="">
  <input id="theme_shortcut" value="true" />
  <input id="theme_highlight_on" value="true" />
  <input id="theme_code_copy" value="true" />
</div>



<body>
<aside class="nav">
    <div class="nav-left">
        <a href="/"
   class="avatar_target">
    <img class="avatar"
         src="/img/cs.jpg"/>
</a>
<div class="author">
    <span>CSEN</span>
</div>

<div class="icon">
    
        
            <a title="rss"
               href="/atom.xml"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-rss"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="github"
               href="https://github.com/Caosen0819"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-github"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="csdn"
               href="https://blog.csdn.net/weixin_45592424?type=blog"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-csdn"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="email"
               href="mailto:caosen0819@163.com"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-email"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="qq"
               href="http://wpa.qq.com/msgrd?v=3&uin=1667018430&site=qq&menu=yes"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-qq"></use>
                    </svg>
                
            </a>
        
    
        
            <a title="neteasemusic"
               href="https://music.163.com/#/user/home?id=406574616"
               target="_blank">
                
                    <svg class="iconfont-svg" aria-hidden="true">
                        <use xlink:href="#icon-neteasemusic"></use>
                    </svg>
                
            </a>
        
    
</div>





<ul>
    <li>
        <div class="all active" data-rel="All">All
            
                <small>(37)</small>
            
        </div>
    </li>
    
        
            
                
    <li>
        <div data-rel="ç®—æ³•">
            
            ç®—æ³•
            <small>(3)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="é¡¹ç›®å®è·µ">
            
            é¡¹ç›®å®è·µ
            <small>(5)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="å­¦ä¹ èµ„æ–™">
            
            å­¦ä¹ èµ„æ–™
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="Java">
            
            Java
            <small>(27)</small>
        </div>
        
    </li>

            
        
    
        
            
                
    <li>
        <div data-rel="new">
            
            new
            <small>(1)</small>
        </div>
        
    </li>

            
        
    
</ul>
<div class="left-bottom">
    <div class="menus">
        
            
            
            
    </div>
    <div>
        
            <a class="about  hasFriend  site_url"
               
               href="/about">About</a>
        
        <a style="width: 50%"
                
                                           class="friends">Friends</a>
        
    </div>
</div>
<input type="hidden" id="yelog_site_posts_number" value="37">
<input type="hidden" id="yelog_site_word_count" value="128.9k">
<div style="display: none">
    <span id="busuanzi_value_site_uv"></span>
    <span id="busuanzi_value_site_pv"></span>
</div>

    </div>
    <div class="nav-right">
        <div class="friends-area">
    <div class="friends-title">
        Links
        <i class="iconfont icon-left"></i>
    </div>
    <div class="friends-content">
        <ul>
            
        </ul>
    </div>
</div>
        <div class="title-list">
    <div class="right-top">
        <div id="default-panel">
            <i class="iconfont icon-search" data-title="æœç´¢ å¿«æ·é”® i"></i>
            <div class="right-title">All</div>
            <i class="iconfont icon-file-tree" data-title="åˆ‡æ¢åˆ°å¤§çº²è§†å›¾ å¿«æ·é”® w"></i>
        </div>
        <div id="search-panel">
            <i class="iconfont icon-left" data-title="è¿”å›"></i>
            <input id="local-search-input" autocomplete="off"/>
            <label class="border-line" for="input"></label>
            <i class="iconfont icon-case-sensitive" data-title="å¤§å°å†™æ•æ„Ÿ"></i>
            <i class="iconfont icon-tag" data-title="æ ‡ç­¾"></i>
        </div>
        <div id="outline-panel" style="display: none">
            <div class="right-title">å¤§çº²</div>
            <i class="iconfont icon-list" data-title="åˆ‡æ¢åˆ°æ–‡ç« åˆ—è¡¨"></i>
        </div>
    </div>

    <div class="tags-list">
    <input id="tag-search" />
    <div class="tag-wrapper">
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æš—é€šé“</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>æµ‹è¯•</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åœºæ™¯é¢˜</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åŸºç¡€</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è®¡ç®—æœºç½‘ç»œ</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>è®¾è®¡æ¨¡å¼</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>åˆ·é¢˜</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>å¾®ä¿¡å°ç¨‹åº</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>DBRouter-starter</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Java</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Javaå¹¶å‘</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JavaåŸºç¡€çŸ¥è¯†</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>JVM</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Kafka</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>luckyé¡¹ç›®</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>mybatis-starter</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Mysql</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>new</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Oauth2</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>Redis</a>
            </li>
        
            <li class="article-tag-list-item">
                <i class="iconfont icon-tag"></i><a>spring</a>
            </li>
        
    </div>

</div>

    
    <nav id="title-list-nav">
        
        
        <a  class="All Java "
           href="/2024/07/09/Spring-%E4%BA%8B%E5%8A%A1/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="Spring-äº‹åŠ¡">Spring-äº‹åŠ¡</span>
            <span class="post-date" title="2024-07-09 00:00:00">2024/07/09</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/05/20/Oauth2-%E6%9D%83%E9%99%90%E6%A0%A1%E9%AA%8C%E7%90%86%E8%A7%A3%E7%AF%87/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-æƒé™æ ¡éªŒç®€å•ç†è§£ç¯‡">Oauth2-æƒé™æ ¡éªŒç®€å•ç†è§£ç¯‡</span>
            <span class="post-date" title="2024-05-20 14:43:00">2024/05/20</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/05/04/Oauth2-%E6%95%B4%E5%90%88%E7%AF%87/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-æ•´åˆç¯‡">Oauth2-æ•´åˆç¯‡</span>
            <span class="post-date" title="2024-05-04 13:35:52">2024/05/04</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/04/11/Spring-IOC%E7%9A%84%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B/"
           data-tag="spring"
           data-author="" >
            <span class="post-title" title="Spring-IOC">Spring-IOC</span>
            <span class="post-date" title="2024-04-11 00:00:00">2024/04/11</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/03/21/Oauth2-%E5%BC%82%E5%B8%B8%E9%85%8D%E7%BD%AE%E7%AF%87/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-å¼‚å¸¸é…ç½®æ€»ç»“">Oauth2-å¼‚å¸¸é…ç½®æ€»ç»“</span>
            <span class="post-date" title="2024-03-21 23:44:51">2024/03/21</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/03/09/Oauth2-%E4%BB%A4%E7%89%8C%E9%85%8D%E7%BD%AE%E7%AF%87/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-ä»¤ç‰Œé…ç½®ç¯‡">Oauth2-ä»¤ç‰Œé…ç½®ç¯‡</span>
            <span class="post-date" title="2024-03-09 12:32:47">2024/03/09</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/03/07/Oauth2-%E9%89%B4%E6%9D%83%E6%9C%8D%E5%8A%A1%E7%AF%87/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-é‰´æƒæœåŠ¡ç¯‡">Oauth2-é‰´æƒæœåŠ¡ç¯‡</span>
            <span class="post-date" title="2024-03-07 18:56:34">2024/03/07</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/03/04/Oauth2-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%E7%AF%87-springsecurity/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-å‰ç½®çŸ¥è¯†ç¯‡-Security">Oauth2-å‰ç½®çŸ¥è¯†ç¯‡-Security</span>
            <span class="post-date" title="2024-03-04 21:32:11">2024/03/04</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/02/02/%E5%85%AB%E8%82%A1-MySQL45/"
           data-tag="Mysql"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-MySQL45">å…«è‚¡-MySQL45</span>
            <span class="post-date" title="2024-02-02 21:29:04">2024/02/02</span>
        </a>
        
        
        <a  class="All Java "
           href="/2024/02/02/%E5%85%AB%E8%82%A1-%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98/"
           data-tag="Java"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-é¢è¯•èŒƒå›´">å…«è‚¡-é¢è¯•èŒƒå›´</span>
            <span class="post-date" title="2024-02-02 21:29:04">2024/02/02</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/11/08/%E5%85%AB%E8%82%A1-JUC/"
           data-tag="Javaå¹¶å‘"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-JUC">å…«è‚¡-JUC</span>
            <span class="post-date" title="2023-11-08 00:00:00">2023/11/08</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/11/08/%E5%85%AB%E8%82%A1-mysql%E6%8A%80%E6%9C%AF%E5%86%85%E5%B9%95/"
           data-tag="Mysql"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-mysqlæŠ€æœ¯å†…å¹•">å…«è‚¡-mysqlæŠ€æœ¯å†…å¹•</span>
            <span class="post-date" title="2023-11-08 00:00:00">2023/11/08</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/11/04/%E5%85%AB%E8%82%A1-JVM/"
           data-tag="JVM"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-JVM">å…«è‚¡-JVM</span>
            <span class="post-date" title="2023-11-04 00:00:00">2023/11/04</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/10/10/%E5%85%AB%E8%82%A1-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"
           data-tag="è®¾è®¡æ¨¡å¼"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-è®¾è®¡æ¨¡å¼">å…«è‚¡-è®¾è®¡æ¨¡å¼</span>
            <span class="post-date" title="2023-10-10 00:00:00">2023/10/10</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/10/09/%E5%85%AB%E8%82%A1-Redis/"
           data-tag="Redis"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-Redis">å…«è‚¡-Redis</span>
            <span class="post-date" title="2023-10-09 00:00:00">2023/10/09</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/08/19/%E5%88%B7%E9%A2%98-JZ20240206/"
           data-tag="åˆ·é¢˜"
           data-author="" >
            <span class="post-title" title="Hot100">Hot100</span>
            <span class="post-date" title="2023-08-19 00:00:00">2023/08/19</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/08/19/%E5%88%B7%E9%A2%98-hot/"
           data-tag="åˆ·é¢˜"
           data-author="" >
            <span class="post-title" title="Hot100">Hot100</span>
            <span class="post-date" title="2023-08-19 00:00:00">2023/08/19</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/08/19/%E5%88%B7%E9%A2%98-hot1000124/"
           data-tag="åˆ·é¢˜"
           data-author="" >
            <span class="post-title" title="Hot100">Hot100</span>
            <span class="post-date" title="2023-08-19 00:00:00">2023/08/19</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/08/19/%E5%88%B7%E9%A2%98-shua/"
           data-tag="åˆ·é¢˜"
           data-author="" >
            <span class="post-title" title="Javaåˆ·é¢˜">Javaåˆ·é¢˜</span>
            <span class="post-date" title="2023-08-19 00:00:00">2023/08/19</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/08/07/%E5%85%AB%E8%82%A1-Java%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"
           data-tag="JavaåŸºç¡€çŸ¥è¯†"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-JavaåŸºç¡€çŸ¥è¯†">å…«è‚¡-JavaåŸºç¡€çŸ¥è¯†</span>
            <span class="post-date" title="2023-08-07 00:00:00">2023/08/07</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/07/08/%E5%85%AB%E8%82%A1-Kafka/"
           data-tag="Kafka"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-Kafka">å…«è‚¡-Kafka</span>
            <span class="post-date" title="2023-07-08 00:00:00">2023/07/08</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/07/08/%E5%85%AB%E8%82%A1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C1/"
           data-tag="è®¡ç®—æœºç½‘ç»œ"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-è®¡ç®—æœºç½‘ç»œ1">å…«è‚¡-è®¡ç®—æœºç½‘ç»œ1</span>
            <span class="post-date" title="2023-07-08 00:00:00">2023/07/08</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/07/08/%E5%85%AB%E8%82%A1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C3/"
           data-tag="è®¡ç®—æœºç½‘ç»œ"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-è®¡ç®—æœºç½‘ç»œ3">å…«è‚¡-è®¡ç®—æœºç½‘ç»œ3</span>
            <span class="post-date" title="2023-07-08 00:00:00">2023/07/08</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/07/08/%E5%85%AB%E8%82%A1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C2/"
           data-tag="è®¡ç®—æœºç½‘ç»œ"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-è®¡ç®—æœºç½‘ç»œ2">å…«è‚¡-è®¡ç®—æœºç½‘ç»œ2</span>
            <span class="post-date" title="2023-07-08 00:00:00">2023/07/08</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/07/08/%E5%85%AB%E8%82%A1-%E8%BE%93%E5%85%A5%E7%BD%91%E7%BB%9C%EF%BC%8C%E6%9C%9F%E9%97%B4%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88%EF%BC%9F/"
           data-tag="è®¡ç®—æœºç½‘ç»œ"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-è¾“å…¥ç½‘ç»œï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ">å…«è‚¡-è¾“å…¥ç½‘ç»œï¼ŒæœŸé—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</span>
            <span class="post-date" title="2023-07-08 00:00:00">2023/07/08</span>
        </a>
        
        
        <a  class="All é¡¹ç›®å®è·µ "
           href="/2023/04/26/%E9%A1%B9%E7%9B%AE-mybatis%E7%BB%84%E4%BB%B6/"
           data-tag="mybatis-starter"
           data-author="" >
            <span class="post-title" title="é¡¹ç›®-mybatisç»„ä»¶">é¡¹ç›®-mybatisç»„ä»¶</span>
            <span class="post-date" title="2023-04-26 00:00:00">2023/04/26</span>
        </a>
        
        
        <a  class="All é¡¹ç›®å®è·µ "
           href="/2023/04/22/%E9%A1%B9%E7%9B%AE-DBRouter%E7%BB%84%E4%BB%B6/"
           data-tag="DBRouter-starter"
           data-author="" >
            <span class="post-title" title="é¡¹ç›®-DBRouterç»„ä»¶">é¡¹ç›®-DBRouterç»„ä»¶</span>
            <span class="post-date" title="2023-04-22 00:00:00">2023/04/22</span>
        </a>
        
        
        <a  class="All å­¦ä¹ èµ„æ–™ "
           href="/2023/04/11/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/"
           data-tag="æµ‹è¯•"
           data-author="" >
            <span class="post-title" title="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span>
            <span class="post-date" title="2023-04-11 00:00:00">2023/04/11</span>
        </a>
        
        
        <a  class="All new "
           href="/2023/04/04/New%20page/"
           data-tag="new"
           data-author="" >
            <span class="post-title" title="å¾…å®š">å¾…å®š</span>
            <span class="post-date" title="2023-04-04 00:00:00">2023/04/04</span>
        </a>
        
        
        <a  class="All Java "
           href="/2023/04/04/%E5%85%AB%E8%82%A1-%E5%9C%BA%E6%99%AF%E9%A2%98/"
           data-tag="åœºæ™¯é¢˜"
           data-author="" >
            <span class="post-title" title="å…«è‚¡-å…¶ä½™é—®é¢˜">å…«è‚¡-å…¶ä½™é—®é¢˜</span>
            <span class="post-date" title="2023-04-04 00:00:00">2023/04/04</span>
        </a>
        
        
        <a  class="All é¡¹ç›®å®è·µ "
           href="/2023/04/03/%E9%A1%B9%E7%9B%AE-Lucky%E6%8A%BD%E5%A5%96/"
           data-tag="luckyé¡¹ç›®"
           data-author="" >
            <span class="post-title" title="é¡¹ç›®-LuckyæŠ½å¥–">é¡¹ç›®-LuckyæŠ½å¥–</span>
            <span class="post-date" title="2023-04-03 00:00:00">2023/04/03</span>
        </a>
        
        
        <a  class="All ç®—æ³• "
           href="/2022/10/23/%E7%AE%97%E6%B3%95-%E5%8E%BB%E9%9B%BE%E8%AE%BA%E6%96%87%E5%8F%82%E8%80%83/"
           data-tag="æš—é€šé“"
           data-author="" >
            <span class="post-title" title="ç®—æ³•-å»é›¾è®ºæ–‡å‚è€ƒ">ç®—æ³•-å»é›¾è®ºæ–‡å‚è€ƒ</span>
            <span class="post-date" title="2022-10-23 13:03:43">2022/10/23</span>
        </a>
        
        
        <a  class="All ç®—æ³• "
           href="/2022/10/23/%E7%AE%97%E6%B3%95-%E6%9A%97%E9%80%9A%E9%81%93%E5%8E%BB%E9%9B%BE%E6%80%BB%E7%BB%93/"
           data-tag="æš—é€šé“"
           data-author="" >
            <span class="post-title" title="ç®—æ³•-æš—é€šé“å»é›¾ç®—æ³•æ€»ç»“">ç®—æ³•-æš—é€šé“å»é›¾ç®—æ³•æ€»ç»“</span>
            <span class="post-date" title="2022-10-23 13:03:43">2022/10/23</span>
        </a>
        
        
        <a  class="All é¡¹ç›®å®è·µ "
           href="/2022/10/04/%E9%A1%B9%E7%9B%AE-%E5%85%BB%E7%94%9F%E6%89%93%E5%8D%A1%E5%81%A5%E5%BA%B7%E5%B0%8F%E7%A8%8B%E5%BA%8F/"
           data-tag="å¾®ä¿¡å°ç¨‹åº"
           data-author="" >
            <span class="post-title" title="é¡¹ç›®-å…»ç”Ÿæ‰“å¡å¥åº·å°ç¨‹åº">é¡¹ç›®-å…»ç”Ÿæ‰“å¡å¥åº·å°ç¨‹åº</span>
            <span class="post-date" title="2022-10-04 13:35:52">2022/10/04</span>
        </a>
        
        
        <a  class="All é¡¹ç›®å®è·µ "
           href="/2022/10/04/%E9%A1%B9%E7%9B%AE-%E6%89%93%E5%8D%A1%E7%A7%AF%E5%88%86%E5%88%B6%E8%87%AA%E5%BE%8B%E5%B0%8F%E7%A8%8B%E5%BA%8F/"
           data-tag="å¾®ä¿¡å°ç¨‹åº"
           data-author="" >
            <span class="post-title" title="é¡¹ç›®-æ—¥å¸¸æ‰“å¡ç§¯åˆ†åˆ¶è‡ªå¾‹å°ç¨‹åº">é¡¹ç›®-æ—¥å¸¸æ‰“å¡ç§¯åˆ†åˆ¶è‡ªå¾‹å°ç¨‹åº</span>
            <span class="post-date" title="2022-10-04 13:35:52">2022/10/04</span>
        </a>
        
        
        <a  class="All Java "
           href="/2022/04/01/Oauth2-%E8%AE%A4%E8%AF%81%E6%9C%8D%E5%8A%A1%E7%AF%87/"
           data-tag="Oauth2"
           data-author="" >
            <span class="post-title" title="Oauth2-è®¤è¯æœåŠ¡ç¯‡">Oauth2-è®¤è¯æœåŠ¡ç¯‡</span>
            <span class="post-date" title="2022-04-01 08:22:13">2022/04/01</span>
        </a>
        
        
        <a  class="All ç®—æ³• "
           href="/2022/02/13/%E7%AE%97%E6%B3%95-%E5%9F%BA%E7%A1%80%E9%98%85%E8%AF%BB/"
           data-tag="åŸºç¡€"
           data-author="" >
            <span class="post-title" title="ç®—æ³•-åŸºç¡€é˜…è¯»">ç®—æ³•-åŸºç¡€é˜…è¯»</span>
            <span class="post-date" title="2022-02-13 13:03:43">2022/02/13</span>
        </a>
        
        <div id="no-item-tips">

        </div>
    </nav>
    <div id="outline-list">
    </div>
</div>

    </div>
    <div class="hide-list">
        <div class="semicircle" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s">
            <div class="brackets first"><</div>
            <div class="brackets">&gt;</div>
        </div>
    </div>
</aside>
<div id="post">
    <div class="pjax">
        <article id="post-Spring-IOCçš„åŠ è½½è¿‡ç¨‹" class="article article-type-post" itemscope itemprop="blogPost">
    
        <h1 class="article-title">Spring-IOC</h1>
    
    <div class="article-meta">
        
        
        
        <span class="book">
            <i class="iconfont icon-category"></i>
            
            
            <a  data-rel="Java">Java</a>
            
        </span>
        
        
        <span class="tag">
            <i class="iconfont icon-tag"></i>
            
            <a class="color2">spring</a>
            
        </span>
        
    </div>
    <div class="article-meta">
        
            Created At : <time class="date" title='Updated At: 2024-07-09 23:30:35'>2024-04-11 00:00</time>
        
    </div>
    <div class="article-meta">
        
        <span>Count:12.6k</span>
        
        
        <span id="busuanzi_container_page_pv">
            Views ğŸ‘€ :<span id="busuanzi_value_page_pv">
                <span class="count-comment">
                    <span class="spinner">
                      <div class="cube1"></div>
                      <div class="cube2"></div>
                    </span>
                </span>
            </span>
        </span>
        
        
    </div>
    
    <div class="toc-ref">
    
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B"><span class="toc-text">ä¸€ã€åˆå§‹åŒ–æµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81refresh-%E5%AE%B9%E5%99%A8%E5%88%B7%E6%96%B0%E6%B5%81%E7%A8%8B-%E6%9C%80%E9%87%8D%E8%A6%81"><span class="toc-text">ä¸‰ã€refresh()å®¹å™¨åˆ·æ–°æµç¨‹(æœ€é‡è¦)</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%87%8D%E7%82%B9%E5%88%B0%E4%BA%86%EF%BC%9AfinishBeanFactoryInitialization-beanFactory-%E5%88%9D%E5%A7%8B%E5%8C%96%E6%89%80%E6%9C%89%E7%9A%84-singleton-beans%EF%BC%88%E5%8D%95%E4%BE%8Bbean%EF%BC%89%EF%BC%8C%E6%87%92%E5%8A%A0%E8%BD%BD%EF%BC%88non-lazy-init%EF%BC%89%E7%9A%84%E9%99%A4%E5%A4%96%EF%BC%8C%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%E4%B9%9F%E6%98%AF%E7%AD%89%E4%BC%9A%E7%BB%86%E8%AF%B4"><span class="toc-text">é‡ç‚¹åˆ°äº†ï¼šfinishBeanFactoryInitialization(beanFactory);åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beansï¼ˆå•ä¾‹beanï¼‰ï¼Œæ‡’åŠ è½½ï¼ˆnon-lazy-initï¼‰çš„é™¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç­‰ä¼šç»†è¯´</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E4%BB%AC%E9%87%8D%E7%82%B9%E6%9D%A5%E7%9C%8BConfigurableListableBeanFactory-beanFactory-obtainFreshBeanFactory-%E5%92%8CfinishBeanFactoryInitialization-beanFactory-%E8%BF%99%E4%B8%A4%E4%B8%AA%E6%96%B9%E6%B3%95"><span class="toc-text">æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory();å’ŒfinishBeanFactoryInitialization(beanFactory);è¿™ä¸¤ä¸ªæ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%8D%E7%9C%8BpreProcessXml-root-%EF%BC%8C%E7%82%B9%E8%BF%9B%E5%8E%BB%E4%B8%80%E7%9C%8B%E6%98%AF%E7%A9%BA%E5%AE%9E%E7%8E%B0%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%98%AFprotected%E7%9A%84%EF%BC%8C%E9%82%A3%E4%B9%88%E5%BE%88%E6%98%8E%E6%98%BE%E8%BF%99%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F-%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E4%B8%8D%E4%BA%86%E8%A7%A3%E7%9A%84%E5%8F%AF%E4%BB%A5%E7%9C%8B%E6%88%91%E7%9A%84%E8%BF%99%E7%AF%87%E6%96%87%E7%AB%A0-%EF%BC%8C%E5%90%8C%E7%90%86postProcessXml-root-%E4%B9%9F%E4%B8%80%E6%A0%B7%EF%BC%8C%E5%B0%B1%E6%98%AF%E5%9C%A8Bean%E5%AE%9A%E4%B9%89%E5%88%9B%E5%BB%BA%E5%89%8D%E5%90%8E%E6%8F%90%E4%BE%9B%E6%89%A9%E5%B1%95%E7%82%B9%E3%80%82"><span class="toc-text">å†çœ‹preProcessXml(root)ï¼Œç‚¹è¿›å»ä¸€çœ‹æ˜¯ç©ºå®ç°ï¼Œå¹¶ä¸”æ˜¯protectedçš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼(æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« )ï¼ŒåŒç†postProcessXml(root)ä¹Ÿä¸€æ ·ï¼Œå°±æ˜¯åœ¨Beanå®šä¹‰åˆ›å»ºå‰åæä¾›æ‰©å±•ç‚¹ã€‚</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B0%E6%AD%A4%E4%B8%BA%E6%AD%A2%EF%BC%8CConfigurableListableBeanFactory-beanFactory-x3D-obtainFreshBeanFactory-%E7%BB%93%E6%9D%9F"><span class="toc-text">åˆ°æ­¤ä¸ºæ­¢ï¼ŒConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory();ç»“æŸ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E9%9D%A2%E6%88%91%E4%BB%AC%E6%9D%A5%E7%9C%8BfinishBeanFactoryInitialization-beanFactory"><span class="toc-text">ä¸‹é¢æˆ‘ä»¬æ¥çœ‹finishBeanFactoryInitialization(beanFactory)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%96%B9%E6%B3%95%E4%B8%AD%E6%9C%89%E4%B8%AAbean%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E8%BF%87%E7%A8%8B%E6%88%91%E4%BB%AC%E5%BF%85%E9%A1%BB%E7%9F%A5%E9%81%93"><span class="toc-text">åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­æœ‰ä¸ªbeançš„å®ä¾‹åŒ–è¿‡ç¨‹æˆ‘ä»¬å¿…é¡»çŸ¥é“</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B0%E5%A2%9EObjectFactory%E5%88%B0%E7%AC%AC%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">æ–°å¢ObjectFactoryåˆ°ç¬¬ä¸‰çº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E5%A1%AB%E5%85%85%EF%BC%9ApopulateBean"><span class="toc-text">å±æ€§å¡«å……ï¼špopulateBean</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#factorybean%E5%92%8Cbeanfactory"><span class="toc-text">factorybeanå’Œbeanfactory</span></a></li></ol></li></ol>
    
<style>
    .left-col .switch-btn,
    .left-col .switch-area {
        display: none;
    }
    .toc-level-3 i,
    .toc-level-3 ol {
        display: none !important;
    }
</style>
</div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>åœ¨åŠŸèƒ½ä¸Šï¼ŒSpringBootçš„å®¹å™¨å¯åŠ¨è¿‡ç¨‹åŸºæœ¬éµå¾ªäº†Springçš„æ ‡å‡†å¯åŠ¨è¿‡ç¨‹ï¼Œä½†æ˜¯åœ¨å…·ä½“å®ç°ä¸Šï¼ŒSpringBootæä¾›äº†ä¸€äº›ç‰¹æ®Šçš„æœºåˆ¶æ¥ç®€åŒ–Springå®¹å™¨çš„é…ç½®å’Œå¯åŠ¨ã€‚</strong></p>
<p><strong>é¦–å…ˆï¼ŒSpringBootè‡ªåŠ¨é…ç½®äº†å¾ˆå¤šå¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶ï¼Œä½¿å¾—åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨é…ç½®å°±èƒ½å¤Ÿä½¿ç”¨è¿™äº›åº“å’Œæ¡†æ¶ã€‚å…¶æ¬¡ï¼ŒSpringBootæä¾›äº†ä¸€äº›åŸºç¡€è®¾æ–½å’Œçº¦å®šæ¥ç®€åŒ–Springçš„é…ç½®ï¼Œä¾‹å¦‚é»˜è®¤çš„ç›®å½•ç»“æ„ã€é»˜è®¤çš„é…ç½®æ–‡ä»¶åã€é»˜è®¤çš„å±æ€§é…ç½®ç­‰ï¼Œè¿™äº›éƒ½èƒ½å¤Ÿå‡å°‘å¼€å‘è€…çš„é…ç½®å·¥ä½œã€‚æœ€åï¼ŒSpringBootæä¾›äº†ä¸€äº›è‡ªå®šä¹‰æ‰©å±•æœºåˆ¶ï¼Œä¾‹å¦‚é€šè¿‡@ConfigurationPropertiesæ³¨è§£æ¥ç»‘å®šé…ç½®æ–‡ä»¶å±æ€§åˆ°Javaå¯¹è±¡ï¼Œé€šè¿‡SpringApplicationç±»çš„addListeners()æ–¹æ³•æ¥æ·»åŠ è‡ªå®šä¹‰çš„å¯åŠ¨ç›‘å¬å™¨ç­‰ç­‰ï¼Œè¿™äº›æ‰©å±•æœºåˆ¶èƒ½å¤Ÿè®©å¼€å‘è€…æ›´åŠ æ–¹ä¾¿åœ°è‡ªå®šä¹‰å’Œæ‰©å±•SpringBootçš„åŠŸèƒ½ã€‚</strong></p>
<p><strong>æ€»çš„æ¥è¯´ï¼ŒSpringBootå¹¶æ²¡æœ‰æ”¹å˜Springçš„æ ¸å¿ƒæœºåˆ¶å’Œå¯åŠ¨è¿‡ç¨‹ï¼Œä½†æ˜¯å®ƒåœ¨å…·ä½“å®ç°ä¸Šæä¾›äº†å¾ˆå¤šä¾¿åˆ©å’Œç®€åŒ–ï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿæ›´åŠ å¿«é€Ÿåœ°å¼€å‘å’Œéƒ¨ç½²åº”ç”¨ç¨‹åº</strong></p>
<p>æ€»ä½“åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼›</p>
<ul>
<li>ä¸€ã€refreshä¹‹å‰</li>
<li>äºŒã€è°ƒç”¨refresh()æ–¹æ³•åˆ·æ–°å®¹å™¨</li>
</ul>
<h2 id="ä¸€ã€åˆå§‹åŒ–æµç¨‹"><a href="#ä¸€ã€åˆå§‹åŒ–æµç¨‹" class="headerlink" title="ä¸€ã€åˆå§‹åŒ–æµç¨‹"></a>ä¸€ã€åˆå§‹åŒ–æµç¨‹</h2><ol>
<li>åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¸€ä¸ª ApplicationContextInitializer åˆ—è¡¨ï¼Œç”¨äºå¯¹ Spring åº”ç”¨ä¸Šä¸‹æ–‡è¿›è¡Œåˆå§‹åŒ–ã€‚ApplicationContextInitializer æ˜¯ Spring 4.1 å¼•å…¥çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå…è®¸ç”¨æˆ·åœ¨å®¹å™¨å¯åŠ¨ä¹‹å‰ï¼Œå¯¹ Spring åº”ç”¨ä¸Šä¸‹æ–‡è¿›è¡Œä¸€äº›é¢å¤–çš„åˆå§‹åŒ–å·¥ä½œã€‚</li>
<li>åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¸€ä¸ª ResourceLoader å¯¹è±¡ï¼Œç”¨äºåŠ è½½é…ç½®æ–‡ä»¶ã€‚ResourceLoader æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå®šä¹‰äº†èµ„æºåŠ è½½çš„åŸºæœ¬æ–¹æ³•ã€‚Spring å®¹å™¨é»˜è®¤ä½¿ç”¨ DefaultResourceLoader ä½œä¸º ResourceLoader å®ç°ç±»ã€‚</li>
<li>åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¸€ä¸ª PropertyResolver å¯¹è±¡ï¼Œç”¨äºè§£æé…ç½®æ–‡ä»¶ä¸­çš„å±æ€§ã€‚PropertyResolver ä¹Ÿæ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒå®šä¹‰äº†å±æ€§è§£æçš„åŸºæœ¬æ–¹æ³•ã€‚Spring å®¹å™¨é»˜è®¤ä½¿ç”¨ PropertySourcesPlaceholderConfigurer ä½œä¸º PropertyResolver å®ç°ç±»ã€‚</li>
<li>åŠ è½½å’Œè§£æé…ç½®æ–‡ä»¶ï¼Œå°†è§£æåçš„é…ç½®ä¿¡æ¯å°è£…æˆä¸€ä¸ª Environment å¯¹è±¡ã€‚Environment æ˜¯ Spring ä¸­ç”¨äºæè¿°åº”ç”¨ç¯å¢ƒçš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒåŒ…å«äº†å„ç§é…ç½®å±æ€§å’Œå±æ€§å€¼ã€‚</li>
<li>å°†è§£æåçš„é…ç½®ä¿¡æ¯å°è£…æˆä¸€ä¸ª ConfigurableEnvironment å¯¹è±¡ï¼Œå¹¶å°†å…¶è®¾ç½®åˆ°å®¹å™¨ä¸­ã€‚ConfigurableEnvironment æ˜¯ Environment çš„ä¸€ä¸ªå­æ¥å£ï¼Œå®ƒå®šä¹‰äº†ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œå¦‚æ·»åŠ å±æ€§ã€æ¿€æ´»é…ç½®æ–‡ä»¶ç­‰ã€‚</li>
<li>åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¸€ä¸ª BeanFactoryPostProcessor åˆ—è¡¨ï¼Œç”¨äºåœ¨ BeanFactory åŠ è½½ Bean å®šä¹‰ä¹‹åï¼Œå¯¹ Bean å®šä¹‰è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚BeanFactoryPostProcessor æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†åœ¨ BeanFactory åŠ è½½ Bean å®šä¹‰ä¹‹åï¼Œä¿®æ”¹ Bean å®šä¹‰çš„æœºä¼šã€‚</li>
<li>åˆ›å»ºå¹¶å®ä¾‹åŒ–ä¸€ä¸ª BeanPostProcessor åˆ—è¡¨ï¼Œç”¨äºåœ¨ Bean å®ä¾‹åŒ–ä¹‹åï¼Œå¯¹ Bean è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚BeanPostProcessor æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå®ƒæä¾›äº†åœ¨ Bean å®ä¾‹åŒ–ä¹‹åï¼Œä¿®æ”¹ Bean å®ä¾‹çš„æœºä¼šã€‚</li>
<li>æ³¨å†Œå¹¶åŠ è½½ BeanFactory ä¸­çš„ Bean å®šä¹‰ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒSpring å®¹å™¨ä¼šæ‰«ææŒ‡å®šçš„åŒ…ï¼ŒæŸ¥æ‰¾æ ‡æ³¨äº† @Componentã€@Serviceã€@Repositoryã€@Controller ç­‰æ³¨è§£çš„ Beanï¼Œå°†å…¶å°è£…æˆ BeanDefinition å¯¹è±¡ï¼Œæ³¨å†Œåˆ° BeanFactory ä¸­ã€‚</li>
<li>è°ƒç”¨ BeanFactoryPostProcessor çš„ postProcessBeanFactory() æ–¹æ³•ï¼Œå¯¹ BeanFactory ä¸­çš„ Bean å®šä¹‰è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</li>
<li>æ³¨å†Œå¹¶åŠ è½½ BeanFactoryPostProcessor ä¸­çš„ Bean å®šä¹‰ã€‚BeanFactoryPostProcessor å¯ä»¥é€šè¿‡å®ç° BeanDefinitionRegistryPostProcessor æ¥å£ï¼Œå‘ BeanFactory ä¸­æ³¨å†Œæ–°çš„ Bean å®šä¹‰ã€‚</li>
<li>åˆå§‹åŒ–å¹¶æ³¨å†Œ ConversionServiceã€‚ConversionService æ˜¯ Spring ä¸­ç”¨äºç±»å‹è½¬æ¢çš„ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå¦ä¸€ä¸ªç±»å‹çš„å¯¹è±¡ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒSpring å®¹å™¨ä¼šæ³¨å†Œä¸€äº›é»˜è®¤çš„è½¬æ¢å™¨ã€‚</li>
<li>åˆå§‹åŒ–å¹¶æ³¨å†Œ LoadTimeWeaverã€‚LoadTimeWeaver æ˜¯ Spring ä¸­ç”¨äºæ”¯æŒåŠ¨æ€ç±»åŠ è½½å’Œå¢å¼ºçš„ä¸€ä¸ªç»„ä»¶ã€‚å®ƒå¯ä»¥å°†ç±»çš„å­—èŠ‚ç åœ¨è¿è¡Œæ—¶è¿›è¡Œå¢å¼ºï¼Œä»è€Œå®ç° AOP ç­‰åŠŸèƒ½ã€‚</li>
<li>åˆå§‹åŒ–å¹¶æ³¨å†Œ Resource</li>
</ol>
<p><strong>ä¸­é—´ç¬¬8æ­¥è§£æè¿‡ç¨‹å¦‚ä¸‹ï¼š</strong></p>
<p>è¿™ä¸ªæ­¥éª¤ä¸»è¦æ˜¯ç”¨æ¥è§£æç”¨æˆ·ä¼ å…¥çš„ Spring é…ç½®ç±»ï¼Œè§£ææˆä¸€ä¸ª BeanDefinition ç„¶åæ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œä¸»è¦æºç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;T&gt; void doRegisterBean(Class&lt;T&gt; annotatedClass, @Nullable Supplier&lt;T&gt; instanceSupplier, @Nullable String name,</span><br><span class="line">		@Nullable Class&lt;? extends Annotation&gt;[] qualifiers, BeanDefinitionCustomizer... definitionCustomizers) &#123;</span><br><span class="line">	// è§£æä¼ å…¥çš„é…ç½®ç±»ï¼Œå®é™…ä¸Šè¿™ä¸ªæ–¹æ³•æ—¢å¯ä»¥è§£æé…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥è§£æ Spring bean å¯¹è±¡</span><br><span class="line">	AnnotatedGenericBeanDefinition abd = new AnnotatedGenericBeanDefinition(annotatedClass);</span><br><span class="line">	// åˆ¤æ–­æ˜¯å¦éœ€è¦è·³è¿‡ï¼Œåˆ¤æ–­ä¾æ®æ˜¯æ­¤ç±»ä¸Šæœ‰æ²¡æœ‰ @Conditional æ³¨è§£</span><br><span class="line">	if (this.conditionEvaluator.shouldSkip(abd.getMetadata())) &#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	abd.setInstanceSupplier(instanceSupplier);</span><br><span class="line">	ScopeMetadata scopeMetadata = this.scopeMetadataResolver.resolveScopeMetadata(abd);</span><br><span class="line">	abd.setScope(scopeMetadata.getScopeName());</span><br><span class="line">	String beanName = (name != null ? name : this.beanNameGenerator.generateBeanName(abd, this.registry));</span><br><span class="line">	// å¤„ç†ç±»ä¸Šçš„é€šç”¨æ³¨è§£</span><br><span class="line">	AnnotationConfigUtils.processCommonDefinitionAnnotations(abd);</span><br><span class="line">	if (qualifiers != null) &#123;</span><br><span class="line">		for (Class&lt;? extends Annotation&gt; qualifier : qualifiers) &#123;</span><br><span class="line">			if (Primary.class == qualifier) &#123;</span><br><span class="line">				abd.setPrimary(true);</span><br><span class="line">			&#125;</span><br><span class="line">			else if (Lazy.class == qualifier) &#123;</span><br><span class="line">				abd.setLazyInit(true);</span><br><span class="line">			&#125;</span><br><span class="line">			else &#123;</span><br><span class="line">				abd.addQualifier(new AutowireCandidateQualifier(qualifier));</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// å°è£…æˆä¸€ä¸ª BeanDefinitionHolder</span><br><span class="line">	for (BeanDefinitionCustomizer customizer : definitionCustomizers) &#123;</span><br><span class="line">		customizer.customize(abd);</span><br><span class="line">	&#125;</span><br><span class="line">	BeanDefinitionHolder definitionHolder = new BeanDefinitionHolder(abd, beanName);</span><br><span class="line">	// å¤„ç† scopedProxyMode</span><br><span class="line">	definitionHolder = AnnotationConfigUtils.applyScopedProxyMode(scopeMetadata, definitionHolder, this.registry);</span><br><span class="line"> </span><br><span class="line">	// æŠŠ BeanDefinitionHolder æ³¨å†Œåˆ° registry</span><br><span class="line">	BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, this.registry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ã€Œæ‰«æã€åœ¨XML/æ³¨è§£/JavaConfig ä¸­éœ€è¦è¢«Springç®¡ç†çš„Beanä¿¡æ¯</span><br><span class="line"></span><br><span class="line">éšåï¼Œä¼šå°†è¿™äº›ä¿¡æ¯å°è£…æˆBeanDefinitionï¼Œæœ€åä¼šæŠŠè¿™äº›ä¿¡æ¯æ”¾åˆ°ä¸€ä¸ªbeanDefinitionMapä¸­</span><br><span class="line">é‚£ä¹ˆBeanDefintiionsæ˜¯ä»€ä¹ˆå‹’ï¼Ÿ</span><br><span class="line"></span><br><span class="line">BeanDefintiionså…¶å®å°±æ˜¯å¯¹Beançš„ä¸€äº›å…ƒæ•°æ®å®šä¹‰</span><br><span class="line">åŒ…æ‹¬parenName çˆ¶ç±»åç§° baenClassNameï¼šç±»åï¼Œscope beançš„ä½œç”¨åŸŸã€‚Abstractæ˜¯å¦æ˜¯æŠ½è±¡çš„ç­‰ä¿¡æ¯ã€‚</span><br><span class="line">é€šè¿‡ BeanDefinitionReaderè·å–åˆ°BeanDefinitionä¹‹å ã€‚æˆ‘ä»¬åœ¨é€šè¿‡BeanDefinitionRegistryå°†beanDefinitionæ³¨å†Œåˆ°BeanFacoryä¸­ã€‚å­˜å‚¨åœ¨BeanFactoryçš„ä¸€ä¸ªconCurrentHashMapä¸­ã€‚keyä¸ºbeanName,Valueå°±æ˜¯BeanDefinitionå…ƒæ•°æ®ã€‚</span><br><span class="line">Springé€šè¿‡BeanDefinationReaderå°†é…ç½®å…ƒä¿¡æ¯åŠ è½½åˆ°å†…å­˜ç”Ÿæˆç›¸åº”çš„BeanDefinationä¹‹åï¼Œå°±å°†å…¶æ³¨å†Œåˆ°BeanDefinationRegistryä¸­ï¼ŒBeanDefinationRegistryå°±æ˜¯ä¸€ä¸ªå­˜æ”¾BeanDefinationçš„å¤§ç¯®å­ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§é”®å€¼å¯¹çš„å½¢å¼ï¼Œé€šè¿‡ç‰¹å®šçš„Beanå®šä¹‰çš„idï¼Œæ˜ å°„åˆ°ç›¸åº”çš„BeanDefination</span><br></pre></td></tr></table></figure>



<p><strong>æ¥ç€ä¼šéå†è¿™ä¸ªbeanDefinitionMapï¼Œæ‰§è¡ŒBeanFactoryPostProcessorè¿™ä¸ªBeanå·¥å‚åç½®å¤„ç†å™¨çš„é€»è¾‘ï¼Œæ¯”å¦‚æ›¿æ¢<code>$</code>å ä½ç¬¦</strong></p>
<p><img src="https://img-blog.csdnimg.cn/690f5df98811421ab1dc6e1495375d71.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQ0Nxd2Fz,size_20,color_FFFFFF,t_70,g_se,x_16" alt="img"></p>
<h2 id="ä¸‰ã€refresh-å®¹å™¨åˆ·æ–°æµç¨‹-æœ€é‡è¦"><a href="#ä¸‰ã€refresh-å®¹å™¨åˆ·æ–°æµç¨‹-æœ€é‡è¦" class="headerlink" title="ä¸‰ã€refresh()å®¹å™¨åˆ·æ–°æµç¨‹(æœ€é‡è¦)"></a>ä¸‰ã€refresh()å®¹å™¨åˆ·æ–°æµç¨‹(æœ€é‡è¦)</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1ã€prepareRefresh()åˆ·æ–°å‰çš„é¢„å¤„ç†ï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰initPropertySources()ï¼šåˆå§‹åŒ–ä¸€äº›å±æ€§è®¾ç½®ï¼Œå­ç±»è‡ªå®šä¹‰ä¸ªæ€§åŒ–çš„å±æ€§è®¾ç½®æ–¹æ³•ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰getEnvironment().validateRequiredProperties()ï¼šæ£€éªŒå±æ€§çš„åˆæ³•æ€§</span><br><span class="line">ï¼ˆ3ï¼‰earlyApplicationEvents = new LinkedHashSet&lt;ApplicationEvent&gt;()ï¼šä¿å­˜å®¹å™¨ä¸­çš„ä¸€äº›æ—©æœŸçš„äº‹ä»¶ï¼›</span><br><span class="line">2ã€obtainFreshBeanFactory()ï¼šè·å–åœ¨å®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºçš„BeanFactoryï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰refreshBeanFactory()ï¼šåˆ·æ–°BeanFactoryï¼Œè®¾ç½®åºåˆ—åŒ–IDï¼›</span><br><span class="line">ï¼ˆ2ï¼‰getBeanFactory()ï¼šè¿”å›åˆå§‹åŒ–ä¸­çš„GenericApplicationContextåˆ›å»ºçš„BeanFactoryå¯¹è±¡ï¼Œå³ã€DefaultListableBeanFactoryã€‘ç±»å‹</span><br><span class="line">3ã€prepareBeanFactory(beanFactory)ï¼šBeanFactoryçš„é¢„å¤„ç†å·¥ä½œï¼Œå‘å®¹å™¨ä¸­æ·»åŠ ä¸€äº›ç»„ä»¶ï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰è®¾ç½®BeanFactoryçš„ç±»åŠ è½½å™¨ã€è®¾ç½®è¡¨è¾¾å¼è§£æå™¨ç­‰ç­‰</span><br><span class="line">ï¼ˆ2ï¼‰æ·»åŠ BeanPostProcessorã€ApplicationContextAwareProcessorã€‘</span><br><span class="line">ï¼ˆ3ï¼‰è®¾ç½®å¿½ç•¥è‡ªåŠ¨è£…é…çš„æ¥å£ï¼šEnvironmentAwareã€EmbeddedValueResolverAwareã€ResourceLoaderAwareã€ApplicationEventPublisherAwareã€MessageSourceAwareã€ApplicationContextAwareï¼›</span><br><span class="line">ï¼ˆ4ï¼‰æ³¨å†Œå¯ä»¥è§£æçš„è‡ªåŠ¨è£…é…ç±»ï¼Œå³å¯ä»¥åœ¨ä»»æ„ç»„ä»¶ä¸­é€šè¿‡æ³¨è§£è‡ªåŠ¨æ³¨å…¥ï¼šBeanFactoryã€ResourceLoaderã€ApplicationEventPublisherã€ApplicationContext</span><br><span class="line">ï¼ˆ5ï¼‰æ·»åŠ BeanPostProcessorã€ApplicationListenerDetectorã€‘</span><br><span class="line">ï¼ˆ6ï¼‰æ·»åŠ ç¼–è¯‘æ—¶çš„AspectJï¼›</span><br><span class="line">ï¼ˆ7ï¼‰ç»™BeanFactoryä¸­æ³¨å†Œçš„3ä¸ªç»„ä»¶ï¼šenvironmentã€ConfigurableEnvironmentã€‘ã€systemPropertiesã€Map&lt;String, Object&gt;ã€‘ã€systemEnvironmentã€Map&lt;String, Object&gt;ã€‘</span><br><span class="line">4ã€postProcessBeanFactory(beanFactory)ï¼šå­ç±»é‡å†™è¯¥æ–¹æ³•ï¼Œå¯ä»¥å®ç°åœ¨BeanFactoryåˆ›å»ºå¹¶é¢„å¤„ç†å®Œæˆä»¥ååšè¿›ä¸€æ­¥çš„è®¾ç½®</span><br><span class="line"></span><br><span class="line">5ã€invokeBeanFactoryPostProcessors(beanFactory)ï¼šåœ¨BeanFactoryæ ‡å‡†åˆå§‹åŒ–ä¹‹åæ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•ï¼Œå³BeanFactoryçš„åç½®å¤„ç†å™¨ï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰å…ˆæ‰§è¡ŒBeanDefinitionRegistryPostProcessorï¼š postProcessor.postProcessBeanDefinitionRegistry(registry)</span><br><span class="line"></span><br><span class="line">â‘  è·å–æ‰€æœ‰çš„å®ç°äº†BeanDefinitionRegistryPostProcessoræ¥å£ç±»å‹çš„é›†åˆ</span><br><span class="line">â‘¡ å…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedä¼˜å…ˆçº§æ¥å£çš„BeanDefinitionRegistryPostProcessor</span><br><span class="line">â‘¢ å†æ‰§è¡Œå®ç°äº†Orderedé¡ºåºæ¥å£çš„BeanDefinitionRegistryPostProcessor</span><br><span class="line">â‘£ æœ€åæ‰§è¡Œæ²¡æœ‰å®ç°ä»»ä½•ä¼˜å…ˆçº§æˆ–è€…æ˜¯é¡ºåºæ¥å£çš„BeanDefinitionRegistryPostProcessors        </span><br><span class="line">ï¼ˆ2ï¼‰å†æ‰§è¡ŒBeanFactoryPostProcessorçš„æ–¹æ³•ï¼špostProcessor.postProcessBeanFactory(beanFactory)</span><br><span class="line"></span><br><span class="line">â‘  è·å–æ‰€æœ‰çš„å®ç°äº†BeanFactoryPostProcessoræ¥å£ç±»å‹çš„é›†åˆ</span><br><span class="line">â‘¡ å…ˆæ‰§è¡Œå®ç°äº†PriorityOrderedä¼˜å…ˆçº§æ¥å£çš„BeanFactoryPostProcessor</span><br><span class="line">â‘¢ å†æ‰§è¡Œå®ç°äº†Orderedé¡ºåºæ¥å£çš„BeanFactoryPostProcessor</span><br><span class="line">â‘£ æœ€åæ‰§è¡Œæ²¡æœ‰å®ç°ä»»ä½•ä¼˜å…ˆçº§æˆ–è€…æ˜¯é¡ºåºæ¥å£çš„BeanFactoryPostProcessor</span><br><span class="line">6ã€registerBeanPostProcessors(beanFactory)ï¼šå‘å®¹å™¨ä¸­æ³¨å†ŒBeançš„åç½®å¤„ç†å™¨BeanPostProcessorï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å¹²é¢„Springåˆå§‹åŒ–beançš„æµç¨‹ï¼Œä»è€Œå®Œæˆä»£ç†ã€è‡ªåŠ¨æ³¨å…¥ã€å¾ªç¯ä¾èµ–ç­‰åŠŸèƒ½</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰è·å–æ‰€æœ‰å®ç°äº†BeanPostProcessoræ¥å£ç±»å‹çš„é›†åˆï¼š</span><br><span class="line">ï¼ˆ2ï¼‰å…ˆæ³¨å†Œå®ç°äº†PriorityOrderedä¼˜å…ˆçº§æ¥å£çš„BeanPostProcessorï¼›</span><br><span class="line">ï¼ˆ3ï¼‰å†æ³¨å†Œå®ç°äº†Orderedä¼˜å…ˆçº§æ¥å£çš„BeanPostProcessorï¼›</span><br><span class="line">ï¼ˆ4ï¼‰æœ€åæ³¨å†Œæ²¡æœ‰å®ç°ä»»ä½•ä¼˜å…ˆçº§æ¥å£çš„BeanPostProcessorï¼›</span><br><span class="line">ï¼ˆ5ï¼‰æœ€rç»ˆæ³¨å†ŒMergedBeanDefinitionPostProcessorç±»å‹çš„BeanPostProcessorï¼šbeanFactory.addBeanPostProcessor(postProcessor);</span><br><span class="line">ï¼ˆ6ï¼‰ç»™å®¹å™¨æ³¨å†Œä¸€ä¸ªApplicationListenerDetectorï¼šç”¨äºåœ¨Beanåˆ›å»ºå®Œæˆåæ£€æŸ¥æ˜¯å¦æ˜¯ApplicationListenerï¼Œå¦‚æœæ˜¯ï¼Œå°±æŠŠBeanæ”¾åˆ°å®¹å™¨ä¸­ä¿å­˜èµ·æ¥ï¼šapplicationContext.addApplicationListener((ApplicationListener&lt;?&gt;) bean);</span><br><span class="line">æ­¤æ—¶å®¹å™¨ä¸­é»˜è®¤æœ‰6ä¸ªé»˜è®¤çš„BeanProcessor(æ— ä»»ä½•ä»£ç†æ¨¡å¼ä¸‹)ï¼šã€ApplicationContextAwareProcessorã€‘ã€ã€ConfigurationClassPostProcessorsAwareBeanPostProcessorã€‘ã€ã€PostProcessorRegistrationDelegateã€‘ã€ã€CommonAnnotationBeanPostProcessorã€‘ã€ã€AutowiredAnnotationBeanPostProcessorã€‘ã€ã€ApplicationListenerDetectorã€‘</span><br><span class="line"></span><br><span class="line">7ã€initMessageSource()ï¼šåˆå§‹åŒ–MessageSourceç»„ä»¶ï¼Œä¸»è¦ç”¨äºåšå›½é™…åŒ–åŠŸèƒ½ï¼Œæ¶ˆæ¯ç»‘å®šä¸æ¶ˆæ¯è§£æï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰çœ‹BeanFactoryå®¹å™¨ä¸­æ˜¯å¦æœ‰idä¸ºmessageSource å¹¶ä¸”ç±»å‹æ˜¯MessageSourceçš„ç»„ä»¶ï¼šå¦‚æœæœ‰ï¼Œç›´æ¥èµ‹å€¼ç»™messageSourceï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªDelegatingMessageSourceï¼›</span><br><span class="line">ï¼ˆ2ï¼‰æŠŠåˆ›å»ºå¥½çš„MessageSourceæ³¨å†Œåœ¨å®¹å™¨ä¸­ï¼Œä»¥åè·å–å›½é™…åŒ–é…ç½®æ–‡ä»¶çš„å€¼çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªåŠ¨æ³¨å…¥MessageSourceï¼›</span><br><span class="line">8ã€initApplicationEventMulticaster()ï¼šåˆå§‹åŒ–äº‹ä»¶æ´¾å‘å™¨ï¼Œåœ¨æ³¨å†Œç›‘å¬å™¨æ—¶ä¼šç”¨åˆ°ï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰çœ‹BeanFactoryå®¹å™¨ä¸­æ˜¯å¦å­˜åœ¨è‡ªå®šä¹‰çš„ApplicationEventMulticasterï¼šå¦‚æœæœ‰ï¼Œç›´æ¥ä»å®¹å™¨ä¸­è·å–ï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªSimpleApplicationEventMulticaster</span><br><span class="line">ï¼ˆ2ï¼‰å°†åˆ›å»ºçš„ApplicationEventMulticasteræ·»åŠ åˆ°BeanFactoryä¸­ï¼Œä»¥åå…¶ä»–ç»„ä»¶å°±å¯ä»¥ç›´æ¥è‡ªåŠ¨æ³¨å…¥</span><br><span class="line">9ã€onRefresh()ï¼šç•™ç»™å­å®¹å™¨ã€å­ç±»é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨å®¹å™¨åˆ·æ–°çš„æ—¶å€™å¯ä»¥è‡ªå®šä¹‰é€»è¾‘</span><br><span class="line"></span><br><span class="line">10ã€registerListeners()ï¼šæ³¨å†Œç›‘å¬å™¨ï¼šå°†å®¹å™¨ä¸­æ‰€æœ‰çš„ApplicationListeneræ³¨å†Œåˆ°äº‹ä»¶æ´¾å‘å™¨ä¸­ï¼Œå¹¶æ´¾å‘ä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„äº‹ä»¶ï¼š</span><br><span class="line"></span><br><span class="line"> ï¼ˆ1ï¼‰ä»å®¹å™¨ä¸­æ‹¿åˆ°æ‰€æœ‰çš„ApplicationListener</span><br><span class="line">ï¼ˆ2ï¼‰å°†æ¯ä¸ªç›‘å¬å™¨æ·»åŠ åˆ°äº‹ä»¶æ´¾å‘å™¨ä¸­ï¼šgetApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);</span><br><span class="line">ï¼ˆ3ï¼‰æ´¾å‘ä¹‹å‰æ­¥éª¤äº§ç”Ÿçš„äº‹ä»¶applicationEventsï¼šgetApplicationEventMulticaster().multicastEvent(earlyEvent);</span><br><span class="line">11ã€finishBeanFactoryInitialization(beanFactory)ï¼šåˆå§‹åŒ–æ‰€æœ‰å‰©ä¸‹çš„å•å®ä¾‹beanï¼Œæ ¸å¿ƒæ–¹æ³•æ˜¯preInstantiateSingletons()ï¼Œä¼šè°ƒç”¨getBean()æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼›</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰è·å–å®¹å™¨ä¸­çš„æ‰€æœ‰beanDefinitionNameï¼Œä¾æ¬¡è¿›è¡Œåˆå§‹åŒ–å’Œåˆ›å»ºå¯¹è±¡</span><br><span class="line">ï¼ˆ2ï¼‰è·å–Beançš„å®šä¹‰ä¿¡æ¯RootBeanDefinitionï¼Œå®ƒè¡¨ç¤ºè‡ªå·±çš„BeanDefinitionå’Œå¯èƒ½å­˜åœ¨çˆ¶ç±»çš„BeanDefinitionåˆå¹¶åçš„å¯¹è±¡</span><br><span class="line">ï¼ˆ3ï¼‰å¦‚æœBeanæ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶ï¼šéæŠ½è±¡çš„ï¼Œå•å®ä¾‹ï¼Œéæ‡’åŠ è½½ï¼Œåˆ™æ‰§è¡Œå•ä¾‹Beanåˆ›å»ºæµç¨‹ï¼š    </span><br><span class="line">ï¼ˆ4ï¼‰æ‰€æœ‰Beanéƒ½åˆ©ç”¨getBean()åˆ›å»ºå®Œæˆä»¥åï¼Œæ£€æŸ¥æ‰€æœ‰çš„Beanæ˜¯å¦ä¸ºSmartInitializingSingletonæ¥å£çš„ï¼Œå¦‚æœæ˜¯ï¼›å°±æ‰§è¡ŒafterSingletonsInstantiated()ï¼›</span><br><span class="line">12ã€finishRefresh()ï¼šå‘å¸ƒBeanFactoryå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶ï¼š</span><br><span class="line"></span><br><span class="line">ï¼ˆ1ï¼‰initLifecycleProcessor()ï¼šåˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„åç½®å¤„ç†å™¨ï¼šé»˜è®¤ä»å®¹å™¨ä¸­æ‰¾æ˜¯å¦æœ‰lifecycleProcessorçš„ç»„ä»¶ã€LifecycleProcessorã€‘ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªDefaultLifecycleProcessor()åŠ å…¥åˆ°å®¹å™¨ï¼›</span><br><span class="line">ï¼ˆ2ï¼‰getLifecycleProcessor().onRefresh()ï¼šæ‹¿åˆ°å‰é¢å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ï¼ˆLifecycleProcessorï¼‰å›è°ƒonRefresh()æ–¹æ³•</span><br><span class="line">ï¼ˆ3ï¼‰publishEvent(new ContextRefreshedEvent(this))ï¼šå‘å¸ƒå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶ï¼›</span><br><span class="line">ï¼ˆ4ï¼‰liveBeansView.registerApplicationContext(this);</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•é‡Œé¢è°ƒç”¨äº†å¾ˆå¤šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä»å¼€å§‹è¯´èµ·ï¼š</p>
<ul>
<li><p>é¦–å…ˆæ˜¯ä¸€ä¸ªsynchronizedåŠ é”ï¼Œå½“ç„¶è¦åŠ é”ï¼Œä¸ç„¶ä½ å…ˆè°ƒä¸€æ¬¡refresh()ç„¶åè¿™æ¬¡è¿˜æ²¡å¤„ç†å®Œåˆè°ƒä¸€æ¬¡ï¼Œå°±ä¼šä¹±å¥—äº†ï¼›</p>
</li>
<li><p>æ¥ç€å¾€ä¸‹çœ‹prepareRefresh();è¿™ä¸ªæ–¹æ³•æ˜¯åšå‡†å¤‡å·¥ä½œçš„ï¼Œè®°å½•å®¹å™¨çš„å¯åŠ¨æ—¶é—´ã€æ ‡è®°â€œå·²å¯åŠ¨â€çŠ¶æ€ã€å¤„ç†é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦ï¼Œå¯ä»¥ç‚¹è¿›å»çœ‹çœ‹ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p>
</li>
<li><p>ä¸‹ä¸€æ­¥ConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory();è¿™ä¸ªå°±å¾ˆé‡è¦äº†ï¼Œè¿™ä¸€æ­¥æ˜¯æŠŠé…ç½®æ–‡ä»¶è§£ææˆä¸€ä¸ªä¸ªBeanDefinitionï¼Œå¹¶ä¸”æ³¨å†Œåˆ°BeanFactoryä¸­ï¼Œæ³¨æ„**<u>è¿™é‡Œåªæ˜¯æ³¨å†Œè¿›å»ï¼Œå¹¶æ²¡æœ‰å®ä¾‹åŒ–</u>**ã€‚å…ˆç»§ç»­å¾€ä¸‹çœ‹ï¼Œç­‰ä¼šå±•å¼€è¿™ä¸ªæ–¹æ³•è¯¦ç»†è§£è¯»</p>
</li>
<li><p>ç„¶åæ˜¯prepareBeanFactory(beanFactory);è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ï¼šè®¾ç½® BeanFactory çš„ç±»åŠ è½½å™¨ï¼Œæ·»åŠ å‡ ä¸ª BeanPostProcessorï¼Œæ‰‹åŠ¨æ³¨å†Œå‡ ä¸ªç‰¹æ®Šçš„ beanï¼Œè¿™é‡Œéƒ½æ˜¯springé‡Œé¢çš„ç‰¹æ®Šå¤„ç†ï¼Œç„¶åç»§ç»­å¾€ä¸‹çœ‹</p>
</li>
<li><p>postProcessBeanFactory(beanFactory);<strong><u>æ–¹æ³•æ˜¯æä¾›ç»™å­ç±»çš„æ‰©å±•ç‚¹ï¼Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ Bean éƒ½åŠ è½½ã€æ³¨å†Œå®Œæˆäº†ï¼Œä½†æ˜¯éƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œå…·ä½“çš„å­ç±»å¯ä»¥åœ¨è¿™æ­¥çš„æ—¶å€™æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„ BeanFactoryPostProcessor çš„å®ç°ç±»ï¼Œæ¥å®Œæˆä¸€äº›å…¶ä»–çš„æ“ä½œã€‚</u></strong></p>
</li>
<li><p>æ¥ä¸‹æ¥æ˜¯invokeBeanFactoryPostProcessors(beanFactory);<u><strong>è¿™ä¸ªæ–¹æ³•æ˜¯è°ƒç”¨ BeanFactoryPostProcessor å„ä¸ªå®ç°ç±»çš„ postProcessBeanFactory(factory) æ–¹æ³•ï¼›</strong></u></p>
</li>
<li><p>ç„¶åæ˜¯registerBeanPostProcessors(beanFactory);è¿™ä¸ªæ–¹æ³•æ³¨å†Œ BeanPostProcessor çš„å®ç°ç±»ï¼Œå’Œä¸Šé¢çš„BeanFactoryPostProcessor æ˜¯æœ‰åŒºåˆ«çš„ï¼Œè¿™ä¸ªæ–¹æ³•è°ƒç”¨çš„å…¶å®æ˜¯PostProcessorRegistrationDelegateç±»çš„registerBeanPostProcessorsæ–¹æ³•ï¼›è¿™ä¸ªç±»é‡Œé¢æœ‰ä¸ªå†…éƒ¨ç±»BeanPostProcessorCheckerï¼ŒBeanPostProcessorCheckeré‡Œé¢æœ‰ä¸¤ä¸ªæ–¹æ³•postProcessBeforeInitializationå’ŒpostProcessAfterInitializationï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åœ¨ Bean åˆå§‹åŒ–ä¹‹å‰å’Œåˆå§‹åŒ–ä¹‹åå¾—åˆ°æ‰§è¡Œã€‚ç„¶åå›åˆ°refresh()æ–¹æ³•ä¸­ç»§ç»­å¾€ä¸‹çœ‹</p>
</li>
<li><p>initMessageSource();æ–¹æ³•æ˜¯åˆå§‹åŒ–å½“å‰ ApplicationContext çš„ MessageSourceï¼Œå›½é™…åŒ–å¤„ç†ï¼Œç»§ç»­å¾€ä¸‹</p>
</li>
<li><p>initApplicationEventMulticaster();æ–¹æ³•åˆå§‹åŒ–å½“å‰ ApplicationContext çš„äº‹ä»¶å¹¿æ’­å™¨ç»§ç»­å¾€ä¸‹</p>
</li>
<li><p>onRefresh();<u>æ–¹æ³•åˆå§‹åŒ–ä¸€äº›ç‰¹æ®Šçš„ Beanï¼ˆåœ¨åˆå§‹åŒ– singleton beans ä¹‹å‰ï¼‰ï¼›ç»§ç»­å¾€ä¸‹</u></p>
</li>
<li><p>registerListeners();æ–¹æ³•æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬å™¨éœ€è¦å®ç° ApplicationListener æ¥å£ï¼›ç»§ç»­å¾€ä¸‹</p>
</li>
<li><h5 id="é‡ç‚¹åˆ°äº†ï¼šfinishBeanFactoryInitialization-beanFactory-åˆå§‹åŒ–æ‰€æœ‰çš„-singleton-beansï¼ˆå•ä¾‹beanï¼‰ï¼Œæ‡’åŠ è½½ï¼ˆnon-lazy-initï¼‰çš„é™¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç­‰ä¼šç»†è¯´"><a href="#é‡ç‚¹åˆ°äº†ï¼šfinishBeanFactoryInitialization-beanFactory-åˆå§‹åŒ–æ‰€æœ‰çš„-singleton-beansï¼ˆå•ä¾‹beanï¼‰ï¼Œæ‡’åŠ è½½ï¼ˆnon-lazy-initï¼‰çš„é™¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç­‰ä¼šç»†è¯´" class="headerlink" title="é‡ç‚¹åˆ°äº†ï¼šfinishBeanFactoryInitialization(beanFactory);åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beansï¼ˆå•ä¾‹beanï¼‰ï¼Œæ‡’åŠ è½½ï¼ˆnon-lazy-initï¼‰çš„é™¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç­‰ä¼šç»†è¯´"></a>é‡ç‚¹åˆ°äº†ï¼šfinishBeanFactoryInitialization(beanFactory);<u>åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beansï¼ˆå•ä¾‹beanï¼‰ï¼Œæ‡’åŠ è½½ï¼ˆnon-lazy-initï¼‰çš„é™¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç­‰ä¼šç»†è¯´</u></h5></li>
<li><p>finishRefresh();æ–¹æ³•æ˜¯æœ€åä¸€æ­¥ï¼Œå¹¿æ’­äº‹ä»¶ï¼ŒApplicationContext åˆå§‹åŒ–å®Œæˆ</p>
</li>
</ul>
<h3 id="æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ConfigurableListableBeanFactory-beanFactory-obtainFreshBeanFactory-å’ŒfinishBeanFactoryInitialization-beanFactory-è¿™ä¸¤ä¸ªæ–¹æ³•"><a href="#æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ConfigurableListableBeanFactory-beanFactory-obtainFreshBeanFactory-å’ŒfinishBeanFactoryInitialization-beanFactory-è¿™ä¸¤ä¸ªæ–¹æ³•" class="headerlink" title="æˆ‘ä»¬é‡ç‚¹æ¥çœ‹ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();å’ŒfinishBeanFactoryInitialization(beanFactory);è¿™ä¸¤ä¸ªæ–¹æ³•"></a>æˆ‘ä»¬é‡ç‚¹æ¥çœ‹<code>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</code>å’Œ<code>finishBeanFactoryInitialization(beanFactory);</code>è¿™ä¸¤ä¸ªæ–¹æ³•</h3><p>å…ˆè¯´<code>ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory()</code>; è¿™ä¸€æ­¥ä¸Šé¢ç®€å•ä»‹ç»è¿‡äº†ï¼Œä½œç”¨æ˜¯æŠŠé…ç½®æ–‡ä»¶è§£ææˆä¸€ä¸ªä¸ªBeanBeanDefinitionï¼Œå¹¶ä¸”æ³¨å†Œåˆ°BeanFactoryä¸­ï¼Œç‚¹è¿›å»æºç ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected ConfigurableListableBeanFactory obtainFreshBeanFactory() &#123;</span><br><span class="line">	refreshBeanFactory();</span><br><span class="line">	ConfigurableListableBeanFactory beanFactory = getBeanFactory();</span><br><span class="line">	if (logger.isDebugEnabled()) &#123;</span><br><span class="line">		logger.debug(&quot;Bean factory for &quot; + getDisplayName() + &quot;: &quot; + beanFactory);</span><br><span class="line">	&#125;</span><br><span class="line">	return beanFactory;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•ä¸­ç¬¬ä¸€æ­¥refreshBeanFactory();æ–¹æ³•çš„ä½œç”¨æ˜¯å…³é—­æ—§çš„ BeanFactory (å¦‚æœæœ‰)ï¼Œåˆ›å»ºæ–°çš„ BeanFactoryï¼ŒåŠ è½½ Bean å®šä¹‰ã€æ³¨å†Œ Bean ç­‰ï¼Œç„¶ågetBeanFactory();å°±æ˜¯è¿”å›åˆšåˆšåˆ›å»ºçš„ BeanFactory(å…¶å®å°±æ˜¯DefaultListableBeanFactory)ï¼Œæˆ‘ä»¬è¿›å…¥refreshBeanFactory();æ–¹æ³•ï¼Œåœ¨AbstractRefreshableApplicationContextç±»ä¸­ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected final void refreshBeanFactory() throws BeansException &#123;</span><br><span class="line">	if (hasBeanFactory()) &#123;</span><br><span class="line">		destroyBeans();</span><br><span class="line">		closeBeanFactory();</span><br><span class="line">	&#125;</span><br><span class="line">	try &#123;</span><br><span class="line">		DefaultListableBeanFactory beanFactory = createBeanFactory();</span><br><span class="line">		beanFactory.setSerializationId(getId());</span><br><span class="line">		customizeBeanFactory(beanFactory);</span><br><span class="line">		loadBeanDefinitions(beanFactory);</span><br><span class="line">		synchronized (this.beanFactoryMonitor) &#123;</span><br><span class="line">			this.beanFactory = beanFactory;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	catch (IOException ex) &#123;</span><br><span class="line">		throw new ApplicationContextException(&quot;I/O error parsing bean definition source for &quot; + getDisplayName(), ex);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¿™ä¸ªrefreshBeanFactory()æ–¹æ³•é¦–å…ˆå¦‚æœ ApplicationContext ä¸­å·²ç»åŠ è½½è¿‡ BeanFactory<br>äº†ï¼Œé”€æ¯æ‰€æœ‰ Beanï¼Œå…³é—­ BeanFactoryï¼›è¿™é‡ŒæŒ‡çš„æ˜¯å½“å‰ApplicationContext æ˜¯å¦æœ‰ BeanFactoryã€‚<br>ç„¶åcreateBeanFactory();åˆå§‹åŒ–ä¸€ä¸ªDefaultListableBeanFactoryï¼Œè¿™ä¸ªDefaultListableBeanFactoryæ˜¯å¾ˆé‡çš„ä¸€ä¸ªç±»ï¼Œä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿå¯ä»¥çœ‹æ–‡ç« å¼€å¤´çš„BeanFactoryç»§æ‰¿å›¾ï¼ŒDefaultListableBeanFactoryæ˜¯ä½äºæœ€ä¸‹é¢çš„ï¼Œä»–å¾€ä¸Šèƒ½èµ°å®ŒBeanFactoryç»§æ‰¿å›¾æ‰€æœ‰ï¼Œæ‰€ä»¥ä»–å¯ä»¥è¯´æ˜¯åŠŸèƒ½æœ€å¤§çš„BeanFactoryã€‚<br>beanFactory.setSerializationId(getId());æ–¹æ³•ç”¨äº BeanFactory çš„åºåˆ—åŒ–<br>customizeBeanFactory(beanFactory);æ–¹æ³•è®¾ç½® BeanFactory çš„ä¸¤ä¸ªé…ç½®å±æ€§ï¼šæ˜¯å¦å…è®¸ Bean è¦†ç›–ã€æ˜¯å¦å…è®¸å¾ªç¯å¼•ç”¨ï¼Œè¿™ä¸ªç­‰ä¼šç»†è¯´<br>loadBeanDefinitions(beanFactory);è¿™ä¸ªæ–¹æ³•å¾ˆé‡è¦ï¼šåŠ è½½ Beanå®šä¹‰ åˆ° BeanFactory ä¸­ï¼Œä¹Ÿæ˜¯ç­‰ä¼šç»†è¯´<br>ä¸‹é¢çœ‹customizeBeanFactory(beanFactory);æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä½œç”¨ï¼šæ˜¯å¦å…è®¸ Bean è¦†ç›–ã€æ˜¯å¦å…è®¸å¾ªç¯å¼•ç”¨ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™å°±è¦è¯´åˆ°BeanDefinitionäº†ï¼Œè¿™é‡Œçš„ BeanDefinition å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ Spring çš„ Beanï¼Œæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„å„ä¸ª Bean å…¶å®ä¼šè½¬æ¢æˆä¸€ä¸ªä¸ª BeanDefinition å­˜åœ¨äº Spring çš„ BeanFactory ä¸­ï¼Œä¸‹é¢è´´å‡ºæ¥å¼€å¤´æˆ‘è¯´çš„å¤§ç¥çš„å…³äºBeanDefinitionæ¥å£çš„ä»£ç æ³¨é‡Šï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinition</span> <span class="keyword">extends</span> <span class="title class_">AttributeAccessor</span>, BeanMetadataElement &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œé»˜è®¤åªæä¾› sington å’Œ prototype ä¸¤ç§ï¼Œ</span></span><br><span class="line">   <span class="comment">// å¾ˆå¤šè¯»è€…å¯èƒ½çŸ¥é“è¿˜æœ‰ request, session, globalSession, application, websocket è¿™å‡ ç§ï¼Œ</span></span><br><span class="line">   <span class="comment">// ä¸è¿‡ï¼Œå®ƒä»¬å±äºåŸºäº web çš„æ‰©å±•ã€‚</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">SCOPE_SINGLETON</span> <span class="operator">=</span> ConfigurableBeanFactory.SCOPE_SINGLETON;</span><br><span class="line">   <span class="type">String</span> <span class="variable">SCOPE_PROTOTYPE</span> <span class="operator">=</span> ConfigurableBeanFactory.SCOPE_PROTOTYPE;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ¯”è¾ƒä¸é‡è¦ï¼Œç›´æ¥è·³è¿‡å§</span></span><br><span class="line">   <span class="type">int</span> <span class="variable">ROLE_APPLICATION</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">   <span class="type">int</span> <span class="variable">ROLE_SUPPORT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">   <span class="type">int</span> <span class="variable">ROLE_INFRASTRUCTURE</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½®çˆ¶ Beanï¼Œè¿™é‡Œæ¶‰åŠåˆ° bean ç»§æ‰¿ï¼Œä¸æ˜¯ java ç»§æ‰¿ã€‚è¯·å‚è§é™„å½•çš„è¯¦ç»†ä»‹ç»</span></span><br><span class="line">   <span class="comment">// ä¸€å¥è¯å°±æ˜¯ï¼šç»§æ‰¿çˆ¶ Bean çš„é…ç½®ä¿¡æ¯è€Œå·²</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setParentName</span><span class="params">(String parentName)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·å–çˆ¶ Bean</span></span><br><span class="line">   String <span class="title function_">getParentName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½® Bean çš„ç±»åç§°ï¼Œå°†æ¥æ˜¯è¦é€šè¿‡åå°„æ¥ç”Ÿæˆå®ä¾‹çš„</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setBeanClassName</span><span class="params">(String beanClassName)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è·å– Bean çš„ç±»åç§°</span></span><br><span class="line">   String <span class="title function_">getBeanClassName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½® bean çš„ scope</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setScope</span><span class="params">(String scope)</span>;</span><br><span class="line"></span><br><span class="line">   String <span class="title function_">getScope</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½®æ˜¯å¦æ‡’åŠ è½½</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setLazyInit</span><span class="params">(<span class="type">boolean</span> lazyInit)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isLazyInit</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½®è¯¥ Bean ä¾èµ–çš„æ‰€æœ‰çš„ Beanï¼Œæ³¨æ„ï¼Œè¿™é‡Œçš„ä¾èµ–ä¸æ˜¯æŒ‡å±æ€§ä¾èµ–(å¦‚ @Autowire æ ‡è®°çš„)ï¼Œ</span></span><br><span class="line">   <span class="comment">// æ˜¯ depends-on=&quot;&quot; å±æ€§è®¾ç½®çš„å€¼ã€‚</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setDependsOn</span><span class="params">(String... dependsOn)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¿”å›è¯¥ Bean çš„æ‰€æœ‰ä¾èµ–</span></span><br><span class="line">   String[] getDependsOn();</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è®¾ç½®è¯¥ Bean æ˜¯å¦å¯ä»¥æ³¨å…¥åˆ°å…¶ä»– Bean ä¸­ï¼Œåªå¯¹æ ¹æ®ç±»å‹æ³¨å…¥æœ‰æ•ˆï¼Œ</span></span><br><span class="line">   <span class="comment">// å¦‚æœæ ¹æ®åç§°æ³¨å…¥ï¼Œå³ä½¿è¿™è¾¹è®¾ç½®äº† falseï¼Œä¹Ÿæ˜¯å¯ä»¥çš„</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setAutowireCandidate</span><span class="params">(<span class="type">boolean</span> autowireCandidate)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¯¥ Bean æ˜¯å¦å¯ä»¥æ³¨å…¥åˆ°å…¶ä»– Bean ä¸­</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isAutowireCandidate</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// ä¸»è¦çš„ã€‚åŒä¸€æ¥å£çš„å¤šä¸ªå®ç°ï¼Œå¦‚æœä¸æŒ‡å®šåå­—çš„è¯ï¼ŒSpring ä¼šä¼˜å…ˆé€‰æ‹©è®¾ç½® primary ä¸º true çš„ bean</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setPrimary</span><span class="params">(<span class="type">boolean</span> primary)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ˜¯å¦æ˜¯ primary çš„</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isPrimary</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å¦‚æœè¯¥ Bean é‡‡ç”¨å·¥å‚æ–¹æ³•ç”Ÿæˆï¼ŒæŒ‡å®šå·¥å‚åç§°ã€‚å¯¹å·¥å‚ä¸ç†Ÿæ‚‰çš„è¯»è€…ï¼Œè¯·å‚åŠ é™„å½•</span></span><br><span class="line">   <span class="comment">// ä¸€å¥è¯å°±æ˜¯ï¼šæœ‰äº›å®ä¾‹ä¸æ˜¯ç”¨åå°„ç”Ÿæˆçš„ï¼Œè€Œæ˜¯ç”¨å·¥å‚æ¨¡å¼ç”Ÿæˆçš„</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setFactoryBeanName</span><span class="params">(String factoryBeanName)</span>;</span><br><span class="line">   <span class="comment">// è·å–å·¥å‚åç§°</span></span><br><span class="line">   String <span class="title function_">getFactoryBeanName</span><span class="params">()</span>;</span><br><span class="line">   <span class="comment">// æŒ‡å®šå·¥å‚ç±»ä¸­çš„ å·¥å‚æ–¹æ³•åç§°</span></span><br><span class="line">   <span class="keyword">void</span> <span class="title function_">setFactoryMethodName</span><span class="params">(String factoryMethodName)</span>;</span><br><span class="line">   <span class="comment">// è·å–å·¥å‚ç±»ä¸­çš„ å·¥å‚æ–¹æ³•åç§°</span></span><br><span class="line">   String <span class="title function_">getFactoryMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ„é€ å™¨å‚æ•°</span></span><br><span class="line">   ConstructorArgumentValues <span class="title function_">getConstructorArgumentValues</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Bean ä¸­çš„å±æ€§å€¼ï¼Œåé¢ç»™ bean æ³¨å…¥å±æ€§å€¼çš„æ—¶å€™ä¼šè¯´åˆ°</span></span><br><span class="line">   MutablePropertyValues <span class="title function_">getPropertyValues</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ˜¯å¦ singleton</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// æ˜¯å¦ prototype</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isPrototype</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å¦‚æœè¿™ä¸ª Bean æ˜¯è¢«è®¾ç½®ä¸º abstractï¼Œé‚£ä¹ˆä¸èƒ½å®ä¾‹åŒ–ï¼Œ</span></span><br><span class="line">   <span class="comment">// å¸¸ç”¨äºä½œä¸º çˆ¶bean ç”¨äºç»§æ‰¿ï¼Œå…¶å®ä¹Ÿå¾ˆå°‘ç”¨......</span></span><br><span class="line">   <span class="type">boolean</span> <span class="title function_">isAbstract</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="type">int</span> <span class="title function_">getRole</span><span class="params">()</span>;</span><br><span class="line">   String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">   String <span class="title function_">getResourceDescription</span><span class="params">()</span>;</span><br><span class="line">   BeanDefinition <span class="title function_">getOriginatingBeanDefinition</span><span class="params">()</span>;</span><br><span class="line">&#125;BeanDefinition çš„è¦†ç›–é—®é¢˜å°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ bean æ—¶ä½¿ç”¨äº†ç›¸åŒçš„ id æˆ– nameï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒallowBeanDefinitionOverriding å±æ€§ä¸º <span class="literal">null</span>ï¼Œå¦‚æœåœ¨åŒä¸€é…ç½®æ–‡ä»¶ä¸­é‡å¤äº†ï¼Œä¼šæŠ›é”™ï¼Œä½†æ˜¯å¦‚æœä¸æ˜¯åŒä¸€é…ç½®æ–‡ä»¶ä¸­ï¼Œä¼šå‘ç”Ÿè¦†ç›–ã€‚</span><br><span class="line">å¾ªç¯å¼•ç”¨ï¼šA ä¾èµ– Bï¼Œè€Œ B ä¾èµ– Aã€‚æˆ– A ä¾èµ– Bï¼ŒB ä¾èµ– Cï¼Œè€Œ C ä¾èµ– Aã€‚</span><br><span class="line">é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpring å…è®¸å¾ªç¯ä¾èµ–ï¼Œå½“ç„¶å¦‚æœä½ åœ¨ A çš„æ„é€ æ–¹æ³•ä¸­ä¾èµ– Bï¼Œåœ¨ B çš„æ„é€ æ–¹æ³•ä¸­ä¾èµ– A æ˜¯ä¸è¡Œçš„ã€‚</span><br></pre></td></tr></table></figure>

<p>å†çœ‹loadBeanDefinitions(beanFactory) æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å°†æ ¹æ®é…ç½®ï¼ŒåŠ è½½å„ä¸ª Beanï¼Œç„¶åæ”¾åˆ° BeanFactory ä¸­ã€‚å…ˆè´´ä¸Šæºç ï¼šAbstractXmlApplicationContextç±»ä¸­</p>
<pre><code>@Override
protected void loadBeanDefinitions(DefaultListableBeanFactory beanFactory) throws BeansException, IOException &#123;
    // Create a new XmlBeanDefinitionReader for the given BeanFactory.
    XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);
  // Configure the bean definition reader with this context&#39;s
  // resource loading environment.
  beanDefinitionReader.setEnvironment(this.getEnvironment());
  beanDefinitionReader.setResourceLoader(this);
  beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));

  // Allow a subclass to provide custom initialization of the reader,
  // then proceed with actually loading the bean definitions.
  initBeanDefinitionReader(beanDefinitionReader);
  loadBeanDefinitions(beanDefinitionReader);
</code></pre>
<p>}<br>è¿™ä¸ªæºç ä¸­æˆ‘ä»¬é‡ç‚¹çœ‹loadBeanDefinitions(beanDefinitionReader);ï¼Œå†ç‚¹è¿›å»æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(XmlBeanDefinitionReader reader)</span> <span class="keyword">throws</span> BeansException, IOException &#123;</span><br><span class="line">	Resource[] configResources = getConfigResources();</span><br><span class="line">	<span class="keyword">if</span> (configResources != <span class="literal">null</span>) &#123;</span><br><span class="line">		reader.loadBeanDefinitions(configResources);</span><br><span class="line">	&#125;</span><br><span class="line">	String[] configLocations = getConfigLocations();</span><br><span class="line">	<span class="keyword">if</span> (configLocations != <span class="literal">null</span>) &#123;</span><br><span class="line">		reader.loadBeanDefinitions(configLocations);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>åœ¨è¿™æ®µæºç ä¸­æˆ‘ä¹ˆå¯ä»¥çœ‹åˆ°2ä¸ªreader.loadBeanDefinitions()æ–¹æ³•ï¼Œå…¶å®ä¸¤ä¸ªæœ€ç»ˆéƒ½åˆ°äº†ï¼šAbstractBeanDefinitionReaderç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(Resource... resources)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">	Assert.notNull(resources, <span class="string">&quot;Resource array must not be null&quot;</span>);</span><br><span class="line">	<span class="type">int</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (Resource resource : resources) &#123;</span><br><span class="line">		counter += loadBeanDefinitions(resource);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> counter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæ–¹æ³•é‡Œé¢ï¼Œforå¾ªç¯æ¯ä¸€ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªresourceï¼Œæœ€ç»ˆè¿”å› counterï¼Œè¡¨ç¤ºæ€»å…±åŠ è½½äº†å¤šå°‘çš„ BeanDefinitionã€‚<br>è¿›å…¥loadBeanDefinitions(resource);æ–¹æ³•ï¼Œçœ‹æºç ï¼š<br>XmlBeanDefinitionReaderç±»ä¸­çš„ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(EncodedResource encodedResource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">	Assert.notNull(encodedResource, <span class="string">&quot;EncodedResource must not be null&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">		logger.info(<span class="string">&quot;Loading XML bean definitions from &quot;</span> + encodedResource);</span><br><span class="line">	&#125;</span><br><span class="line">  Set&lt;EncodedResource&gt; currentResources = <span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.get();</span><br><span class="line">  <span class="keyword">if</span> (currentResources == <span class="literal">null</span>) &#123;</span><br><span class="line">    currentResources = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(<span class="number">4</span>);</span><br><span class="line">    <span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.set(currentResources);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (!currentResources.add(encodedResource)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">        <span class="string">&quot;Detected cyclic loading of &quot;</span> + encodedResource + <span class="string">&quot; - check your import definitions!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> encodedResource.getResource().getInputStream();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(inputStream);</span><br><span class="line">      <span class="keyword">if</span> (encodedResource.getEncoding() != <span class="literal">null</span>) &#123;</span><br><span class="line">        inputSource.setEncoding(encodedResource.getEncoding());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> doLoadBeanDefinitions(inputSource, encodedResource.getResource());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">      inputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">        <span class="string">&quot;IOException parsing XML document from &quot;</span> + encodedResource.getResource(), ex);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">finally</span> &#123;</span><br><span class="line">    currentResources.remove(encodedResource);</span><br><span class="line">    <span class="keyword">if</span> (currentResources.isEmpty()) &#123;</span><br><span class="line">      <span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.remove();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è¿™æ®µä»£ç ä¸­å¯ä»¥çœ‹åˆ°tryä»£ç å—ä¸­ä¸€å¼€å§‹æ˜¯æ ¹æ®å¤–å±‚å¾ªç¯è°ƒç”¨çš„æ¯ä¸€ä¸ªResourceè§£ææˆä¸€ä¸ªInputStream ç„¶åæ ¹æ®è¿™ä¸ªè¾“å…¥æµè§£æï¼›<br>è¿™æ®µæºç çš„æ ¸å¿ƒåœ¨doLoadBeanDefinitions(inputSource, encodedResource.getResource());ç»§ç»­è¿›æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">doLoadBeanDefinitions</span><span class="params">(InputSource inputSource, Resource resource)</span></span><br><span class="line">		<span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> doLoadDocument(inputSource, resource);</span><br><span class="line">		<span class="keyword">return</span> registerBeanDefinitions(doc, resource);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> ex;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (SAXParseException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">				<span class="string">&quot;Line &quot;</span> + ex.getLineNumber() + <span class="string">&quot; in XML document from &quot;</span> + resource + <span class="string">&quot; is invalid&quot;</span>, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (SAXException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">				<span class="string">&quot;XML document from &quot;</span> + resource + <span class="string">&quot; is invalid&quot;</span>, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (ParserConfigurationException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">				<span class="string">&quot;Parser configuration exception parsing XML from &quot;</span> + resource, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">				<span class="string">&quot;IOException parsing XML document from &quot;</span> + resource, ex);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">				<span class="string">&quot;Unexpected exception parsing XML document from &quot;</span> + resource, ex);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å¯ä»¥çœ‹åˆ°doLoadDocument(inputSource, resource);æ–¹æ³•æ˜¯å°† xml æ–‡ä»¶(è¾“å…¥æµå’ŒResource)è½¬æ¢ä¸º Document å¯¹è±¡ï¼Œç„¶åç»§ç»­è¿›æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(Document doc, Resource resource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">	<span class="type">BeanDefinitionDocumentReader</span> <span class="variable">documentReader</span> <span class="operator">=</span> createBeanDefinitionDocumentReader();</span><br><span class="line">	<span class="type">int</span> <span class="variable">countBefore</span> <span class="operator">=</span> getRegistry().getBeanDefinitionCount();</span><br><span class="line">	documentReader.registerBeanDefinitions(doc, createReaderContext(resource));</span><br><span class="line">	<span class="keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªBeanDefinitionDocumentReaderï¼Œç„¶åspringé€šè¿‡BeanDefinitionDocumentReader ä¼šè¿›è¡Œå§”æ‰˜beanå®šä¹‰çš„åˆ›å»ºï¼›<br>ç»§ç»­è¿™ä¸ªæ–¹æ³•é‡Œé¢çœ‹ï¼šdocumentReader.registerBeanDefinitions(doc, createReaderContext(resource));ç‚¹è¿›å»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(Document doc, XmlReaderContext readerContext)</span> &#123;</span><br><span class="line">	<span class="built_in">this</span>.readerContext = readerContext;</span><br><span class="line">	logger.debug(<span class="string">&quot;Loading bean definitions&quot;</span>);</span><br><span class="line">	<span class="type">Element</span> <span class="variable">root</span> <span class="operator">=</span> doc.getDocumentElement();</span><br><span class="line">	doRegisterBeanDefinitions(root);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>é‡Œé¢çš„doRegisterBeanDefinitions(root);æ–¹æ³•å°±æ˜¯ä» xml æ ¹èŠ‚ç‚¹å¼€å§‹è§£ææ–‡ä»¶ï¼Œç»è¿‡å¾ˆå¤šçš„æ­¥éª¤ï¼Œä¸€ä¸ªé…ç½®æ–‡ä»¶ç»ˆäºè½¬æ¢ä¸ºä¸€é¢— DOM æ ‘äº†ï¼Œæ³¨æ„ï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯å…¶ä¸­ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¸æ˜¯æ‰€æœ‰çš„ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢æœ‰ä¸ª for å¾ªç¯çš„(loadBeanDefinitions(resource);æ˜¯åœ¨forå¾ªç¯é‡Œé¢çš„)ï¼Œè¿›å…¥doRegisterBeanDefinitions(root);æ–¹æ³•ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doRegisterBeanDefinitions</span><span class="params">(Element root)</span> &#123;</span><br><span class="line">	<span class="comment">// Any nested &lt;beans&gt; elements will cause recursion in this method. In</span></span><br><span class="line">	<span class="comment">// order to propagate and preserve &lt;beans&gt; default-* attributes correctly,</span></span><br><span class="line">	<span class="comment">// keep track of the current (parent) delegate, which may be null. Create</span></span><br><span class="line">	<span class="comment">// the new (child) delegate with a reference to the parent for fallback purposes,</span></span><br><span class="line">	<span class="comment">// then ultimately reset this.delegate back to its original (parent) reference.</span></span><br><span class="line">	<span class="comment">// this behavior emulates a stack of delegates without actually necessitating one.</span></span><br><span class="line">	<span class="type">BeanDefinitionParserDelegate</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>.delegate;</span><br><span class="line">	<span class="built_in">this</span>.delegate = createDelegate(getReaderContext(), root, parent);</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">this</span>.delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">profileSpec</span> <span class="operator">=</span> root.getAttribute(PROFILE_ATTRIBUTE);</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(profileSpec)) &#123;</span><br><span class="line">      String[] specifiedProfiles = StringUtils.tokenizeToStringArray(</span><br><span class="line">          profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">      <span class="keyword">if</span> (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">          logger.info(<span class="string">&quot;Skipped XML bean definition file due to specified profiles [&quot;</span> + profileSpec +</span><br><span class="line">              <span class="string">&quot;] not matching: &quot;</span> + getReaderContext().getResource());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  preProcessXml(root);</span><br><span class="line">  parseBeanDefinitions(root, <span class="built_in">this</span>.delegate);</span><br><span class="line">  postProcessXml(root);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">this</span>.delegate = parent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»è¿™æ®µä»£ç ä¸­å¯ä»¥çœ‹åˆ°BeanDefinitionDocumentReaderæœ€ç»ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ªBeanDefinitionParserDelegate ï¼ŒæŠŠbeanå®šä¹‰çš„åˆ›å»ºå§”æ‰˜ç»™äº†BeanDefinitionParserDelegate è¿›è¡Œåˆ›å»ºï¼Œè¿™å°±æ˜¯å§”æ‰˜æ¨¡å¼çš„æç°ã€‚<br>åŒæ—¶ä¹Ÿå¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸­å…ˆæŠŠthis.delegateç»™äº†ä¸€ä¸ªparentï¼Œç„¶ååˆåˆ›å»ºäº†ä¸€ä¸ªDelegateï¼Œç„¶åæ‰§è¡Œæœ€ååˆæŠŠè¿™ä¸ªparentç»™å›å»äº†this.delegateï¼Œè¿™æ˜¯ä¸ºäº†å¤„ç†<beans>æ ‡ç­¾åµŒå¥—<beans>çš„é—®é¢˜ï¼Œå…¶å®æ˜¯ä¸ªç±»ä¼¼é€’å½’çš„æ“ä½œã€‚è¿™é‡Œå¤§å®¶å¯ä»¥debuggerè¯•è¯•åµŒå¥—çš„æƒ…å†µå°±æ˜ç™½äº†ã€‚</p>
<h5 id="å†çœ‹preProcessXml-root-ï¼Œç‚¹è¿›å»ä¸€çœ‹æ˜¯ç©ºå®ç°ï¼Œå¹¶ä¸”æ˜¯protectedçš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« -ï¼ŒåŒç†postProcessXml-root-ä¹Ÿä¸€æ ·ï¼Œå°±æ˜¯åœ¨Beanå®šä¹‰åˆ›å»ºå‰åæä¾›æ‰©å±•ç‚¹ã€‚"><a href="#å†çœ‹preProcessXml-root-ï¼Œç‚¹è¿›å»ä¸€çœ‹æ˜¯ç©ºå®ç°ï¼Œå¹¶ä¸”æ˜¯protectedçš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« -ï¼ŒåŒç†postProcessXml-root-ä¹Ÿä¸€æ ·ï¼Œå°±æ˜¯åœ¨Beanå®šä¹‰åˆ›å»ºå‰åæä¾›æ‰©å±•ç‚¹ã€‚" class="headerlink" title="å†çœ‹preProcessXml(root)ï¼Œç‚¹è¿›å»ä¸€çœ‹æ˜¯ç©ºå®ç°ï¼Œå¹¶ä¸”æ˜¯protectedçš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼(æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« )ï¼ŒåŒç†postProcessXml(root)ä¹Ÿä¸€æ ·ï¼Œå°±æ˜¯åœ¨Beanå®šä¹‰åˆ›å»ºå‰åæä¾›æ‰©å±•ç‚¹ã€‚"></a>å†çœ‹preProcessXml(root)ï¼Œç‚¹è¿›å»ä¸€çœ‹æ˜¯ç©ºå®ç°ï¼Œå¹¶ä¸”æ˜¯protectedçš„ï¼Œé‚£ä¹ˆå¾ˆæ˜æ˜¾è¿™å°±æ˜¯ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ¨¡å¼(æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä¸äº†è§£çš„å¯ä»¥çœ‹æˆ‘çš„è¿™ç¯‡æ–‡ç« )ï¼ŒåŒç†postProcessXml(root)ä¹Ÿä¸€æ ·ï¼Œå°±æ˜¯åœ¨Beanå®šä¹‰åˆ›å»ºå‰åæä¾›æ‰©å±•ç‚¹ã€‚</h5><p>é‚£ç»§ç»­è¿›å…¥parseBeanDefinitions(root, this.delegate);çœ‹é‡ç‚¹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">parseBeanDefinitions</span><span class="params">(Element root, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">			<span class="type">NodeList</span> <span class="variable">nl</span> <span class="operator">=</span> root.getChildNodes();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nl.getLength(); i++) &#123;</span><br><span class="line">				<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nl.item(i);</span><br><span class="line">				<span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">					<span class="type">Element</span> <span class="variable">ele</span> <span class="operator">=</span> (Element) node;</span><br><span class="line">					<span class="keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;</span><br><span class="line">						parseDefaultElement(ele, delegate);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">else</span> &#123;</span><br><span class="line">						delegate.parseCustomElement(ele);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			delegate.parseCustomElement(root);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


<p>è¿™æ®µä»£ç æ˜¯å¾ªç¯è§£æElement çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸€èˆ¬æˆ‘ä»¬çš„æ™®é€šbeanéƒ½æ˜¯èµ°parseDefaultElement(ele, delegate);é»˜è®¤çš„è§£ææµç¨‹ã€‚<br>ä½†æ˜¯è¿™é‡Œæœ‰ä¸ªelseçš„è‡ªå®šä¹‰è§£æï¼Œè¿™ä¸ªå¾ˆå¤šäººéƒ½å¿½ç•¥äº†ï¼Œå…¶å®å¦‚æœæˆ‘ä»¬xmlçš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†<a href="aop:config">aop:config</a> æ ‡ç­¾ï¼Œä»–å°±ä¼šèµ°è¿™ä¸ªè‡ªå®šä¹‰è§£æï¼Œç„¶åè§£æaopå†…å®¹ï¼Œåç»­ä¼šåœ¨åˆ†æAOPæºç ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« )è¯´<a href="aop:config">aop:config</a>çš„æ—¶å€™è®²è¿™é‡Œã€‚<br>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯èµ°æ™®é€šçš„beandè§£æé€»è¾‘parseDefaultElement(ele, delegate)ï¼Œè·Ÿè¿›å»çœ‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;</span><br><span class="line">			importBeanDefinitionResource(ele);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;</span><br><span class="line">			processAliasRegistration(ele);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;</span><br><span class="line">			processBeanDefinition(ele, delegate);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;</span><br><span class="line">			<span class="comment">// recurse</span></span><br><span class="line">			doRegisterBeanDefinitions(ele);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


<p>è¿™ä¸ªæ–¹æ³•è§åçŸ¥æ„ï¼Œè§£æé»˜è®¤çš„Elementï¼Œæ˜¯4ä¸ªifåˆ†æ”¯ï¼Œç¬¬ä¸€ä¸ªæ˜¯è§£æimportç±»å‹çš„ï¼Œç¬¬äºŒä¸ªæ˜¯aliasçš„ï¼Œç¬¬ä¸‰ä¸ªæ˜¯beançš„(ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ™®é€šbeané»˜è®¤çš„)ï¼Œç¬¬å››ä¸ªæ˜¯beansï¼Œä¹Ÿå°±æ˜¯åµŒå¥—çš„(è¿™é‡Œè¿™ä¸ªåµŒå¥—çš„å°±å›åˆ°ä¸Šé¢doRegisterBeanDefinitionsæ–¹æ³•äº†ï¼Œä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¯´ä¸Šé¢å…¶å®ç±»ä¼¼é€’å½’çš„åŸå› )<br>è¿™é‡Œæˆ‘ä»¬åªåˆ†ææ™®é€šbeançš„è§£æå¤„ç†ï¼Œè¿›å…¥processBeanDefinition(ele, delegate);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processBeanDefinition</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">	<span class="type">BeanDefinitionHolder</span> <span class="variable">bdHolder</span> <span class="operator">=</span> delegate.parseBeanDefinitionElement(ele);</span><br><span class="line">	<span class="keyword">if</span> (bdHolder != <span class="literal">null</span>) &#123;</span><br><span class="line">		bdHolder = delegate.decorateBeanDefinitionIfRequired(ele, bdHolder);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// Register the final decorated instance.</span></span><br><span class="line">			BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</span><br><span class="line">			getReaderContext().error(<span class="string">&quot;Failed to register bean definition with name &#x27;&quot;</span> +</span><br><span class="line">					bdHolder.getBeanName() + <span class="string">&quot;&#x27;&quot;</span>, ele, ex);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// Send registration event.</span></span><br><span class="line">		getReaderContext().fireComponentRegistered(<span class="keyword">new</span> <span class="title class_">BeanComponentDefinition</span>(bdHolder));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>è¿™æ®µä»£ç é¦–å…ˆé€šè¿‡delegateåˆ›å»ºä¸€ä¸ªbeanå®šä¹‰çš„æŒæœ‰è€…BeanDefinitionHolderï¼Œ<strong>è¿™ä¸€æ­¥å…¶å®BeanDefinitionä¹Ÿåœ¨é‡Œé¢å·²ç»åˆ›å»ºå‡ºæ¥äº†</strong>ã€‚è¿›å…¥delegate.parseBeanDefinitionElement(ele)çœ‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> BeanDefinitionHolder <span class="title function_">parseBeanDefinitionElement</span><span class="params">(Element ele, <span class="meta">@Nullable</span> BeanDefinition containingBean)</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> ele.getAttribute(ID_ATTRIBUTE);</span><br><span class="line">		<span class="type">String</span> <span class="variable">nameAttr</span> <span class="operator">=</span> ele.getAttribute(NAME_ATTRIBUTE);</span><br><span class="line">	List&lt;String&gt; aliases = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">	<span class="keyword">if</span> (StringUtils.hasLength(nameAttr)) &#123;</span><br><span class="line">		String[] nameArr = StringUtils.tokenizeToStringArray(nameAttr, MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">		aliases.addAll(Arrays.asList(nameArr));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> id;</span><br><span class="line">	<span class="keyword">if</span> (!StringUtils.hasText(beanName) &amp;&amp; !aliases.isEmpty()) &#123;</span><br><span class="line">		beanName = aliases.remove(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">			logger.trace(<span class="string">&quot;No XML &#x27;id&#x27; specified - using &#x27;&quot;</span> + beanName +</span><br><span class="line">					<span class="string">&quot;&#x27; as bean name and &quot;</span> + aliases + <span class="string">&quot; as aliases&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (containingBean == <span class="literal">null</span>) &#123;</span><br><span class="line">		checkNameUniqueness(beanName, aliases, ele);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">AbstractBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> parseBeanDefinitionElement(ele, beanName, containingBean);</span><br><span class="line">	<span class="keyword">if</span> (beanDefinition != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!StringUtils.hasText(beanName)) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">if</span> (containingBean != <span class="literal">null</span>) &#123;</span><br><span class="line">					beanName = BeanDefinitionReaderUtils.generateBeanName(</span><br><span class="line">							beanDefinition, <span class="built_in">this</span>.readerContext.getRegistry(), <span class="literal">true</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					beanName = <span class="built_in">this</span>.readerContext.generateBeanName(beanDefinition);</span><br><span class="line">					<span class="comment">// Register an alias for the plain bean class name, if still possible,</span></span><br><span class="line">					<span class="comment">// if the generator returned the class name plus a suffix.</span></span><br><span class="line">					<span class="comment">// This is expected for Spring 1.2/2.0 backwards compatibility.</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">beanClassName</span> <span class="operator">=</span> beanDefinition.getBeanClassName();</span><br><span class="line">					<span class="keyword">if</span> (beanClassName != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">							beanName.startsWith(beanClassName) &amp;&amp; beanName.length() &gt; beanClassName.length() &amp;&amp;</span><br><span class="line">							!<span class="built_in">this</span>.readerContext.getRegistry().isBeanNameInUse(beanClassName)) &#123;</span><br><span class="line">						aliases.add(beanClassName);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">					logger.trace(<span class="string">&quot;Neither XML &#x27;id&#x27; nor &#x27;name&#x27; specified - &quot;</span> +</span><br><span class="line">							<span class="string">&quot;using generated bean name [&quot;</span> + beanName + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">				error(ex.getMessage(), ele);</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		String[] aliasesArray = StringUtils.toStringArray(aliases);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(beanDefinition, beanName, aliasesArray);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°è¿™æ®µä»£ç ä¸­æœ‰ä¸€ä¸ªparseBeanDefinitionElement(ele, beanName, containingBean)ï¼Œ<strong>è¿”å›äº†ä¸€ä¸ªAbstractBeanDefinitionï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢å®é™…æ˜¯åˆ›å»ºäº†ä¸€ä¸ªGenericBeanDefinition</strong>ï¼Œè¿™é‡Œå°±ä¸è·Ÿè¿›å»çœ‹äº†ï¼Œä»£ç ç¯‡å¹…å¤ªé•¿äº†ï¼Œè¿™ä¸ªé‡Œé¢å¾ˆç®€å•æ²¡å•¥ç»•çš„é€»è¾‘ï¼Œå¤§å®¶è·Ÿç€ç‚¹ç‚¹å°±èƒ½çœ‹åˆ°äº†ã€‚åˆ›å»ºå®ŒGenericBeanDefinitionä¹‹åè®¾ç½®äº†Classå±æ€§ã€æ„é€ å™¨ç­‰ç­‰ä¸€äº›åˆ›å»ºBeanå®ä¾‹éœ€è¦çš„ä¸œè¥¿ä¹‹åå°±è¿”å›äº†ã€‚</p>
<p>ç„¶åå›åˆ°processBeanDefinition(ele, delegate);çœ‹BeanDefinitionReaderUtils.registerBeanDefinition(bdHolder, getReaderContext().getRegistry());ï¼Œç”±äºè¿™ä¸ªæ—¶å€™<strong>å·²ç»åˆ›å»ºäº†BeanDefinition</strong>å¹¶ä¸”æœ‰æŒæœ‰è€…BeanDefinitionHolderè¿›è¡Œæ³¨å†Œï¼Œæ‰€ä»¥ç»§ç»­è·Ÿè¿›</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinition</span><span class="params">(</span></span><br><span class="line"><span class="params">			BeanDefinitionHolder definitionHolder, BeanDefinitionRegistry registry)</span></span><br><span class="line">			<span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">      <span class="comment">// Register bean definition under primary name.</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> definitionHolder.getBeanName();</span><br><span class="line">	registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Register aliases for bean name, if any.</span></span><br><span class="line">	String[] aliases = definitionHolder.getAliases();</span><br><span class="line">	<span class="keyword">if</span> (aliases != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (String alias : aliases) &#123;</span><br><span class="line">			registry.registerAlias(beanName, alias);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¾ˆæ˜æ˜¾ç»§ç»­è·Ÿè¿›åˆ°registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªæ¥å£è°ƒç”¨ï¼Œè‚¯å®šæ˜¯åˆ°äº†DefaultListableBeanFactoryï¼Œä½†æ˜¯åœ¨è¿™ä¸ªæ¥å£è°ƒç”¨æ—¶æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œä»BeanDefinitionHolderä¸­è·å–åˆ°äº†BeanDefinitionå¯¹è±¡ï¼Œè¿™ä¸ªå°±æ˜¯åˆ›å»ºBeanå®šä¹‰æŒæœ‰è€…çš„æ—¶å€™é¡ºå¸¦è·å–çš„BeanDefinitionï¼Œé€šè¿‡ä¸Šé¢çš„è§£ææˆ‘ä»¬çŸ¥é“è¿™ä¸ªæ—¶å€™BeanDefinitionå·²ç»åˆ›å»ºå¥½äº†ï¼Œç„¶åè·Ÿè¿›è¿™ä¸ªæ–¹æ³•è¿›å»ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinition</span><span class="params">(String beanName, BeanDefinition beanDefinition)</span></span><br><span class="line">			<span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">	Assert.hasText(beanName, <span class="string">&quot;Bean name must not be empty&quot;</span>);</span><br><span class="line">	Assert.notNull(beanDefinition, <span class="string">&quot;BeanDefinition must not be null&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (beanDefinition <span class="keyword">instanceof</span> AbstractBeanDefinition) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			((AbstractBeanDefinition) beanDefinition).validate();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeanDefinitionValidationException ex) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(beanDefinition.getResourceDescription(), beanName,</span><br><span class="line">					<span class="string">&quot;Validation of bean definition failed&quot;</span>, ex);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">BeanDefinition</span> <span class="variable">existingDefinition</span> <span class="operator">=</span> <span class="built_in">this</span>.beanDefinitionMap.get(beanName);</span><br><span class="line">	<span class="keyword">if</span> (existingDefinition != <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (!isAllowBeanDefinitionOverriding()) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionOverrideException</span>(beanName, beanDefinition, existingDefinition);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (existingDefinition.getRole() &lt; beanDefinition.getRole()) &#123;</span><br><span class="line">			<span class="comment">// e.g. was ROLE_APPLICATION, now overriding with ROLE_SUPPORT or ROLE_INFRASTRUCTURE</span></span><br><span class="line">			<span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">				logger.info(<span class="string">&quot;Overriding user-defined bean definition for bean &#x27;&quot;</span> + beanName +</span><br><span class="line">						<span class="string">&quot;&#x27; with a framework-generated bean definition: replacing [&quot;</span> +</span><br><span class="line">						existingDefinition + <span class="string">&quot;] with [&quot;</span> + beanDefinition + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (!beanDefinition.equals(existingDefinition)) &#123;</span><br><span class="line">			<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">				logger.debug(<span class="string">&quot;Overriding bean definition for bean &#x27;&quot;</span> + beanName +</span><br><span class="line">						<span class="string">&quot;&#x27; with a different definition: replacing [&quot;</span> + existingDefinition +</span><br><span class="line">						<span class="string">&quot;] with [&quot;</span> + beanDefinition + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(<span class="string">&quot;Overriding bean definition for bean &#x27;&quot;</span> + beanName +</span><br><span class="line">						<span class="string">&quot;&#x27; with an equivalent definition: replacing [&quot;</span> + existingDefinition +</span><br><span class="line">						<span class="string">&quot;] with [&quot;</span> + beanDefinition + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (hasBeanCreationStarted()) &#123;</span><br><span class="line">			<span class="comment">// Cannot modify startup-time collection elements anymore (for stable iteration)</span></span><br><span class="line">			<span class="keyword">synchronized</span> (<span class="built_in">this</span>.beanDefinitionMap) &#123;</span><br><span class="line">				<span class="built_in">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</span><br><span class="line">				List&lt;String&gt; updatedDefinitions = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.beanDefinitionNames.size() + <span class="number">1</span>);</span><br><span class="line">				updatedDefinitions.addAll(<span class="built_in">this</span>.beanDefinitionNames);</span><br><span class="line">				updatedDefinitions.add(beanName);</span><br><span class="line">				<span class="built_in">this</span>.beanDefinitionNames = updatedDefinitions;</span><br><span class="line">				removeManualSingletonName(beanName);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// Still in startup registration phase</span></span><br><span class="line">			<span class="built_in">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</span><br><span class="line">			<span class="built_in">this</span>.beanDefinitionNames.add(beanName);</span><br><span class="line">			removeManualSingletonName(beanName);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">this</span>.frozenBeanDefinitionNames = <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (existingDefinition != <span class="literal">null</span> || containsSingleton(beanName)) &#123;</span><br><span class="line">		resetBeanDefinition(beanName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (isConfigurationFrozen()) &#123;</span><br><span class="line">		clearByTypeCache();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢å°±å¯ä»¥çœ‹åˆ°ç»è¿‡ä¸€ç³»åˆ—éªŒè¯ç­‰ç­‰æ“ä½œï¼Œæœ€åæŠŠBeanDefinitionæ”¾å…¥äº†beanDefinitionMapï¼Œåˆ°è¿™é‡Œbeanå®šä¹‰å°±å®Œæˆå¹¶æ³¨å†Œåˆ°org.springframework.beans.factory.support.DefaultListableBeanFactory#beanDefinitionMapé‡Œé¢äº†</p>
<p>ç„¶åæˆ‘ä»¬å›åˆ°refresh() æ–¹æ³•ï¼Œå°±æ˜¯æ–‡ç« å‰éƒ¨åˆ†çš„é‚£ä¸ªrefresh() æ–¹æ³•â€¦TvT<br>å†è´´ä¸€ä¸‹refresh() æ–¹æ³•çš„æºç å§ï¼Œæ–¹ä¾¿é˜…è¯»ï¼š<br>æˆ‘ç›´æ¥è´´å¤§ç¥å¸¦æ³¨é‡Šçš„ä»£ç å§ï¼Œçœ‹èµ·æ¥æ›´æ–¹ä¾¿ä¸€ç‚¹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">   <span class="comment">// æ¥ä¸ªé”ï¼Œä¸ç„¶ refresh() è¿˜æ²¡ç»“æŸï¼Œä½ åˆæ¥ä¸ªå¯åŠ¨æˆ–é”€æ¯å®¹å™¨çš„æ“ä½œï¼Œé‚£ä¸å°±ä¹±å¥—äº†å˜›</span></span><br><span class="line">   <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">   <span class="comment">// å‡†å¤‡å·¥ä½œï¼Œè®°å½•ä¸‹å®¹å™¨çš„å¯åŠ¨æ—¶é—´ã€æ ‡è®°â€œå·²å¯åŠ¨â€çŠ¶æ€ã€å¤„ç†é…ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦</span></span><br><span class="line">  prepareRefresh();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿™æ­¥æ¯”è¾ƒå…³é”®ï¼Œè¿™æ­¥å®Œæˆåï¼Œé…ç½®æ–‡ä»¶å°±ä¼šè§£ææˆä¸€ä¸ªä¸ª Bean å®šä¹‰ï¼Œæ³¨å†Œåˆ° BeanFactory ä¸­ï¼Œ</span></span><br><span class="line">  <span class="comment">// å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„ Bean è¿˜æ²¡æœ‰åˆå§‹åŒ–ï¼Œåªæ˜¯é…ç½®ä¿¡æ¯éƒ½æå–å‡ºæ¥äº†ï¼Œ</span></span><br><span class="line">  <span class="comment">// æ³¨å†Œä¹Ÿåªæ˜¯å°†è¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åˆ°äº†æ³¨å†Œä¸­å¿ƒ(è¯´åˆ°åº•æ ¸å¿ƒæ˜¯ä¸€ä¸ª beanName-&gt; beanDefinition çš„ map)</span></span><br><span class="line">  <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è®¾ç½® BeanFactory çš„ç±»åŠ è½½å™¨ï¼Œæ·»åŠ å‡ ä¸ª BeanPostProcessorï¼Œæ‰‹åŠ¨æ³¨å†Œå‡ ä¸ªç‰¹æ®Šçš„ bean</span></span><br><span class="line">  <span class="comment">// è¿™å—å¾…ä¼šä¼šå±•å¼€è¯´</span></span><br><span class="line">  prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">     <span class="comment">// ã€è¿™é‡Œéœ€è¦çŸ¥é“ BeanFactoryPostProcessor è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼ŒBean å¦‚æœå®ç°äº†æ­¤æ¥å£ï¼Œ</span></span><br><span class="line">     <span class="comment">// é‚£ä¹ˆåœ¨å®¹å™¨åˆå§‹åŒ–ä»¥åï¼ŒSpring ä¼šè´Ÿè´£è°ƒç”¨é‡Œé¢çš„ postProcessBeanFactory æ–¹æ³•ã€‚ã€‘</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">// è¿™é‡Œæ˜¯æä¾›ç»™å­ç±»çš„æ‰©å±•ç‚¹ï¼Œåˆ°è¿™é‡Œçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ Bean éƒ½åŠ è½½ã€æ³¨å†Œå®Œæˆäº†ï¼Œä½†æ˜¯éƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–</span></span><br><span class="line">     <span class="comment">// å…·ä½“çš„å­ç±»å¯ä»¥åœ¨è¿™æ­¥çš„æ—¶å€™æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„ BeanFactoryPostProcessor çš„å®ç°ç±»æˆ–åšç‚¹ä»€ä¹ˆäº‹</span></span><br><span class="line">     postProcessBeanFactory(beanFactory);</span><br><span class="line">     <span class="comment">// è°ƒç”¨ BeanFactoryPostProcessor å„ä¸ªå®ç°ç±»çš„ postProcessBeanFactory(factory) å›è°ƒæ–¹æ³•</span></span><br><span class="line">     invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">      <span class="comment">// æ³¨å†Œ BeanPostProcessor çš„å®ç°ç±»ï¼Œæ³¨æ„çœ‹å’Œ BeanFactoryPostProcessor çš„åŒºåˆ«</span></span><br><span class="line">     <span class="comment">// æ­¤æ¥å£ä¸¤ä¸ªæ–¹æ³•: postProcessBeforeInitialization å’Œ postProcessAfterInitialization</span></span><br><span class="line">     <span class="comment">// ä¸¤ä¸ªæ–¹æ³•åˆ†åˆ«åœ¨ Bean åˆå§‹åŒ–ä¹‹å‰å’Œåˆå§‹åŒ–ä¹‹åå¾—åˆ°æ‰§è¡Œã€‚è¿™é‡Œä»…ä»…æ˜¯æ³¨å†Œï¼Œä¹‹åä¼šçœ‹åˆ°å›è°ƒè¿™ä¸¤æ–¹æ³•çš„æ—¶æœº</span></span><br><span class="line">     registerBeanPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// åˆå§‹åŒ–å½“å‰ ApplicationContext çš„ MessageSourceï¼Œå›½é™…åŒ–è¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ï¼Œä¸ç„¶æ²¡å®Œæ²¡äº†äº†</span></span><br><span class="line">     initMessageSource();</span><br><span class="line"></span><br><span class="line">     <span class="comment">// åˆå§‹åŒ–å½“å‰ ApplicationContext çš„äº‹ä»¶å¹¿æ’­å™¨ï¼Œè¿™é‡Œä¹Ÿä¸å±•å¼€äº†</span></span><br><span class="line">     initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">     <span class="comment">// ä»æ–¹æ³•åå°±å¯ä»¥çŸ¥é“ï¼Œå…¸å‹çš„æ¨¡æ¿æ–¹æ³•(é’©å­æ–¹æ³•)ï¼Œä¸å±•å¼€è¯´</span></span><br><span class="line">     <span class="comment">// å…·ä½“çš„å­ç±»å¯ä»¥åœ¨è¿™é‡Œåˆå§‹åŒ–ä¸€äº›ç‰¹æ®Šçš„ Beanï¼ˆåœ¨åˆå§‹åŒ– singleton beans ä¹‹å‰ï¼‰</span></span><br><span class="line">     onRefresh();</span><br><span class="line"></span><br><span class="line">     <span class="comment">// æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬å™¨éœ€è¦å®ç° ApplicationListener æ¥å£ã€‚è¿™ä¹Ÿä¸æ˜¯æˆ‘ä»¬çš„é‡ç‚¹ï¼Œè¿‡</span></span><br><span class="line">     registerListeners();</span><br><span class="line"></span><br><span class="line">     <span class="comment">// é‡ç‚¹ï¼Œé‡ç‚¹ï¼Œé‡ç‚¹</span></span><br><span class="line">     <span class="comment">// åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beans</span></span><br><span class="line">     <span class="comment">//ï¼ˆlazy-init çš„é™¤å¤–ï¼‰</span></span><br><span class="line">     finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// æœ€åï¼Œå¹¿æ’­äº‹ä»¶ï¼ŒApplicationContext åˆå§‹åŒ–å®Œæˆï¼Œä¸å±•å¼€</span></span><br><span class="line">     finishRefresh();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">     <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">        logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">              <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">     <span class="comment">// é”€æ¯å·²ç»åˆå§‹åŒ–çš„ singleton çš„ Beansï¼Œä»¥å…æœ‰äº› bean ä¼šä¸€ç›´å ç”¨èµ„æº</span></span><br><span class="line">     destroyBeans();</span><br><span class="line"></span><br><span class="line">     <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">     cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// æŠŠå¼‚å¸¸å¾€å¤–æŠ›</span></span><br><span class="line">     <span class="keyword">throw</span> ex;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">finally</span> &#123;</span><br><span class="line">     <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">     <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">     resetCommonCaches();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h4 id="åˆ°æ­¤ä¸ºæ­¢ï¼ŒConfigurableListableBeanFactory-beanFactory-x3D-obtainFreshBeanFactory-ç»“æŸ"><a href="#åˆ°æ­¤ä¸ºæ­¢ï¼ŒConfigurableListableBeanFactory-beanFactory-x3D-obtainFreshBeanFactory-ç»“æŸ" class="headerlink" title="åˆ°æ­¤ä¸ºæ­¢ï¼ŒConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory();ç»“æŸ"></a>åˆ°æ­¤ä¸ºæ­¢ï¼ŒConfigurableListableBeanFactory beanFactory &#x3D; obtainFreshBeanFactory();ç»“æŸ</h4><hr>
<h3 id="ä¸‹é¢æˆ‘ä»¬æ¥çœ‹finishBeanFactoryInitialization-beanFactory"><a href="#ä¸‹é¢æˆ‘ä»¬æ¥çœ‹finishBeanFactoryInitialization-beanFactory" class="headerlink" title="ä¸‹é¢æˆ‘ä»¬æ¥çœ‹finishBeanFactoryInitialization(beanFactory)"></a>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹finishBeanFactoryInitialization(beanFactory)</h3><p>åˆ°è¿™ä¸€æ­¥ä¸ºæ­¢BeanFactory å·²ç»åˆ›å»ºå®Œæˆï¼Œå¹¶ä¸”æ‰€æœ‰çš„å®ç°äº† BeanFactoryPostProcessor æ¥å£çš„ Bean éƒ½å·²ç»åˆå§‹åŒ–å¹¶ä¸”å…¶ä¸­çš„ postProcessBeanFactory(factory) æ–¹æ³•å·²ç»å¾—åˆ°å›è°ƒæ‰§è¡Œäº†ã€‚è€Œä¸” Spring å·²ç»â€œæ‰‹åŠ¨â€æ³¨å†Œäº†ä¸€äº›<strong>ç‰¹æ®Šçš„ Beanï¼Œå¦‚ â€˜environmentâ€™ã€â€˜systemPropertiesâ€™ ç­‰</strong>ã€‚å‰©ä¸‹çš„å°±æ˜¯åˆå§‹åŒ– singleton beans äº†ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒä»¬æ˜¯å•ä¾‹çš„ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®æ‡’åŠ è½½ï¼Œé‚£ä¹ˆ Spring ä¼šåœ¨æ¥ä¸‹æ¥åˆå§‹åŒ–æ‰€æœ‰çš„ singleton beansã€‚ç‚¹è¿›å»çœ‹æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">finishBeanFactoryInitialization</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> &#123;</span><br><span class="line">	<span class="comment">// Initialize conversion service for this context.</span></span><br><span class="line">	<span class="keyword">if</span> (beanFactory.containsBean(CONVERSION_SERVICE_BEAN_NAME) &amp;&amp;</span><br><span class="line">			beanFactory.isTypeMatch(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class)) &#123;</span><br><span class="line">		beanFactory.setConversionService(</span><br><span class="line">				beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));</span><br><span class="line">	&#125;</span><br><span class="line">  <span class="comment">// Register a default embedded value resolver if no bean post-processor</span></span><br><span class="line">  <span class="comment">// (such as a PropertyPlaceholderConfigurer bean) registered any before:</span></span><br><span class="line">  <span class="comment">// at this point, primarily for resolution in annotation attribute values.</span></span><br><span class="line">  <span class="keyword">if</span> (!beanFactory.hasEmbeddedValueResolver()) &#123;</span><br><span class="line">    beanFactory.addEmbeddedValueResolver(strVal -&gt; getEnvironment().resolvePlaceholders(strVal));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize LoadTimeWeaverAware beans early to allow for registering their transformers early.</span></span><br><span class="line">  String[] weaverAwareNames = beanFactory.getBeanNamesForType(LoadTimeWeaverAware.class, <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">  <span class="keyword">for</span> (String weaverAwareName : weaverAwareNames) &#123;</span><br><span class="line">    getBean(weaverAwareName);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Stop using the temporary ClassLoader for type matching.</span></span><br><span class="line">  beanFactory.setTempClassLoader(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Allow for caching all bean definition metadata, not expecting further changes.</span></span><br><span class="line">  beanFactory.freezeConfiguration();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">  beanFactory.preInstantiateSingletons();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<p>åœ¨è¿™æ®µä»£ç ä¸­ï¼šé¦–å…ˆåˆå§‹åŒ–åå­—ä¸º â€œconversionServiceâ€ çš„ Beanï¼Œä¸ºä»€ä¹ˆæ˜¯conversionService å‘¢ï¼ŸåŸå› æ˜¯æ³¨å†Œè¿™ä¸ªbeanä¹‹åï¼Œç±»ä¼¼äºå‰ç«¯ä¼ ç»™åç«¯çš„éåŸºç¡€ç±»å‹å’ŒåŸºç¡€ç±»å‹çš„åŒ…è£…ç±»ä¹‹å¤–ï¼Œå…¶ä»–çš„å°±å¯ä»¥è€ƒè™‘é‡‡ç”¨ConversionServiceæ¥è¿›è¡Œç±»å‹ç­‰çš„è½¬æ¢ï¼Œåˆå§‹åŒ–è¿™ä¸ª â€œconversionServiceâ€ å®åœ¨ä¸Šé¢æºç ä¸­çš„beanFactory.getBean(CONVERSION_SERVICE_BEAN_NAME, ConversionService.class));è¿›è¡Œçš„ã€‚ç„¶åç›´æ¥è·³è¿‡æ¥åˆ°beanFactory.preInstantiateSingletons();è¿™ä¸ªæ–¹æ³•ï¼Œè¿™é‡Œå¼€å§‹åˆå§‹åŒ–ã€‚ç‚¹è¿›å»ï¼š<br>DefaultListableBeanFactoryè¿™ä¸ªç±»ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preInstantiateSingletons</span><span class="params">()</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">	<span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">		logger.debug(<span class="string">&quot;Pre-instantiating singletons in &quot;</span> + <span class="built_in">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// Iterate over a copy to allow for init methods which in turn register new bean definitions.</span></span><br><span class="line">  <span class="comment">// While this may not be part of the regular factory bootstrap, it does otherwise work fine.</span></span><br><span class="line">  List&lt;String&gt; beanNames = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.beanDefinitionNames);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Trigger initialization of all non-lazy singleton beans...</span></span><br><span class="line">  <span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">    <span class="type">RootBeanDefinition</span> <span class="variable">bd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line">    <span class="keyword">if</span> (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()) &#123;</span><br><span class="line">      <span class="keyword">if</span> (isFactoryBean(beanName)) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> getBean(FACTORY_BEAN_PREFIX + beanName);</span><br><span class="line">        <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> FactoryBean) &#123;</span><br><span class="line">          <span class="keyword">final</span> FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) bean;</span><br><span class="line">          <span class="type">boolean</span> isEagerInit;</span><br><span class="line">          <span class="keyword">if</span> (System.getSecurityManager() != <span class="literal">null</span> &amp;&amp; factory <span class="keyword">instanceof</span> SmartFactoryBean) &#123;</span><br><span class="line">            isEagerInit = AccessController.doPrivileged((PrivilegedAction&lt;Boolean&gt;)</span><br><span class="line">                    ((SmartFactoryBean&lt;?&gt;) factory)::isEagerInit,</span><br><span class="line">                getAccessControlContext());</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            isEagerInit = (factory <span class="keyword">instanceof</span> SmartFactoryBean &amp;&amp;</span><br><span class="line">                ((SmartFactoryBean&lt;?&gt;) factory).isEagerInit());</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (isEagerInit) &#123;</span><br><span class="line">            getBean(beanName);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        getBean(beanName);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Trigger post-initialization callback for all applicable beans...</span></span><br><span class="line">  <span class="keyword">for</span> (String beanName : beanNames) &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">singletonInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line">    <span class="keyword">if</span> (singletonInstance <span class="keyword">instanceof</span> SmartInitializingSingleton) &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="type">SmartInitializingSingleton</span> <span class="variable">smartSingleton</span> <span class="operator">=</span> (SmartInitializingSingleton) singletonInstance;</span><br><span class="line">      <span class="keyword">if</span> (System.getSecurityManager() != <span class="literal">null</span>) &#123;</span><br><span class="line">        AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123;</span><br><span class="line">          smartSingleton.afterSingletonsInstantiated();</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;, getAccessControlContext());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        smartSingleton.afterSingletonsInstantiated();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<ol>
<li><p>è¿­ä»£æ‰€æœ‰çš„BeanDefinitionNamesé›†åˆï¼ŒæŒ¨ä¸ªåˆå§‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„å•ä¾‹ç±»ã€‚</p>
</li>
<li><p>BeanDefinitionNamesæ˜¯åœ¨æ³¨å†ŒBeanDefinitionMapæ—¶åŒæ—¶æ³¨å†Œçš„é›†åˆã€‚è¯¥é›†åˆï¼Œä¸»è¦ç”¨åœ¨<strong>è¿™é‡Œ</strong>è¿›è¡Œè¿­ä»£åˆå§‹åŒ–Spring Beanï¼Œå¹¶ä¸”ä¹Ÿæ–¹ä¾¿ä¸€äº›ç±»ä¼¼è·å–BeanDefinitionNameçš„æ–¹æ³•ä½¿ç”¨ã€‚</p>
</li>
<li><p>åˆå§‹åŒ–çš„æ—¶å€™è¿˜å¯¹FactoryBeanè¿›è¡Œåˆ¤æ–­ï¼Œå› ä¸ºé»˜è®¤FactoryBeané»˜è®¤æ˜¯æƒ°æ€§åˆå§‹åŒ–ï¼Œå¦‚æœå®ç°SmartFactoryBeanè®¾ç½®isEagerInitä¸ºtrueï¼Œåˆ™ä»£è¡¨è¯¥ç±»éœ€è¦æ€¥åˆ‡çš„è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šå³åˆ»å¼€å§‹åˆå§‹åŒ–FactoryBeané‡ŒgetObjectè¿”å›çš„ç±»ã€‚</p>
</li>
<li><p>å…³äºgetMergedLocalBeanDefinitionå’ŒgetBeanï¼šSpringé€šè¿‡getBeanæ¥å®Œæˆç±»çš„åˆå§‹åŒ–å¹¶æ·»åŠ åˆ°Springå®¹å™¨å†…ï¼ˆå³Springçš„ä¸€çº§ç¼“å­˜ï¼šå•ä¾‹æ± é‡Œé¢ï¼‰ï¼Œè€Œåœ¨åˆå§‹åŒ–æ—¶éœ€è¦å½“å‰ç±»çš„ç›¸å…³ä¿¡æ¯ï¼šå³BeanDefinitionï¼Œè€ŒBeanDefinitionæ˜¯å¯ä»¥å­˜åœ¨çˆ¶å­å…³ç³»ï¼ˆå¹¶éçœŸçš„ç»§æ‰¿ï¼Œè€Œæ˜¯BeanDefinitionå¯ä»¥è®¾ç½®çˆ¶BeanDefinitionï¼‰ï¼Œæ‰€ä»¥Springé€šè¿‡getMergedLocalBeanDefinitionæ¥è·å–å½“å‰ç±»çš„å®Œæ•´ä¿¡æ¯ã€‚</p>
</li>
</ol>
<p>getBean-ã€‹doGetBean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(<span class="keyword">final</span> String name, <span class="meta">@Nullable</span> <span class="keyword">final</span> Class&lt;T&gt; requiredType,</span></span><br><span class="line"><span class="params">			<span class="meta">@Nullable</span> <span class="keyword">final</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">	<span class="comment">// 1.è½¬æ¢beanNameï¼Œä¸»è¦å¤„ç†åˆ«åã€ä»¥&amp;å¼€å¤´çš„name</span></span><br><span class="line">	<span class="keyword">final</span> <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line">	Object bean;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2.å°è¯•ä»å•ä¾‹ç¼“å­˜ä¸­è·å–beanå®ä¾‹</span></span><br><span class="line">	<span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line">	<span class="comment">// 3. è·å–beanå®ä¾‹</span></span><br><span class="line">	<span class="comment">// 3.1 ç¼“å­˜ä¸­å·²å­˜åœ¨beanå®ä¾‹</span></span><br><span class="line">	<span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="comment">// çœç•¥æ—¥å¿—è¾“å‡ºä»£ç ...</span></span><br><span class="line">		<span class="comment">// ä»beanå®ä¾‹ä¸­è·å–å¯¹è±¡ï¼ˆæœ¬ç« é‡ç‚¹ï¼Œè·å–å®ä¾‹ä¸­çš„å¯¹è±¡ï¼‰</span></span><br><span class="line">		bean = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// çœç•¥çˆ¶å·¥å‚å¤„ç†ç›¸å…³ä»£ç ...</span></span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// çœç•¥dependsOnç›¸å…³ä»£ç ...</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">// 3.2 åˆ›å»ºå•ä¾‹bean</span></span><br><span class="line">			<span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">				sharedInstance = getSingleton(beanName, () -&gt; &#123;</span><br><span class="line">					<span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">						destroySingleton(beanName);</span><br><span class="line">						<span class="keyword">throw</span> ex;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;);</span><br><span class="line">				<span class="comment">// ä»beanå®ä¾‹ä¸­è·å–å¯¹è±¡ï¼ˆæœ¬ç« é‡ç‚¹ï¼Œè·å–å®ä¾‹ä¸­çš„å¯¹è±¡ï¼‰</span></span><br><span class="line">				bean = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 3.3 åˆ›å»ºåŸå‹beanå®ä¾‹</span></span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) &#123;</span><br><span class="line">				<span class="comment">// It&#x27;s a prototype -&gt; create a new instance.</span></span><br><span class="line">				<span class="type">Object</span> <span class="variable">prototypeInstance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					beforePrototypeCreation(beanName);</span><br><span class="line">					prototypeInstance = createBean(beanName, mbd, args);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">finally</span> &#123;</span><br><span class="line">					afterPrototypeCreation(beanName);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// ä»beanå®ä¾‹ä¸­è·å–å¯¹è±¡ï¼ˆæœ¬ç« é‡ç‚¹ï¼Œè·å–å®ä¾‹ä¸­çš„å¯¹è±¡ï¼‰</span></span><br><span class="line">				bean = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 3.4 æ ¹æ®scopeåˆ›å»ºbeanå®ä¾‹</span></span><br><span class="line">			<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="type">String</span> <span class="variable">scopeName</span> <span class="operator">=</span> mbd.getScope();</span><br><span class="line">				<span class="keyword">final</span> <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> <span class="built_in">this</span>.scopes.get(scopeName);</span><br><span class="line">				<span class="keyword">if</span> (scope == <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					<span class="type">Object</span> <span class="variable">scopedInstance</span> <span class="operator">=</span> scope.get(beanName, () -&gt; &#123;</span><br><span class="line">						beforePrototypeCreation(beanName);</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">finally</span> &#123;</span><br><span class="line">							afterPrototypeCreation(beanName);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;);</span><br><span class="line">					<span class="comment">// ä»beanå®ä¾‹ä¸­è·å–å¯¹è±¡ï¼ˆæœ¬ç« é‡ç‚¹ï¼Œè·å–å®ä¾‹ä¸­çš„å¯¹è±¡ï¼‰</span></span><br><span class="line">					bean = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">catch</span> (IllegalStateException ex) &#123;</span><br><span class="line">					<span class="comment">// çœç•¥å¼‚å¸¸å¤„ç†ä»£ç ...</span></span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">			cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">			<span class="keyword">throw</span> ex;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// çœç•¥å…¶ä»–ä»£ç .</span></span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>}</p>
<p><strong>åœ¨å¯ä»¥çœ‹åˆ°ä¸Šé¢æœ‰å››ç§æƒ…å†µï¼šç¼“å­˜ä¸­å­˜åœ¨beanå®ä¾‹ã€åˆ›å»ºå•ä¾‹beanã€åˆ›å»ºåŸå‹beanã€æ ¹æ®scopeåˆ›å»ºbeanï¼Œéƒ½è°ƒç”¨äº†getObjectForBeanInstance()æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç‚¹è¿›å»çœ‹çœ‹ã€‚</strong></p>
<p><em><strong>getObjectForBeanInstanceæ˜¯ä»beanå®ä¾‹ä¸­è·å–å¯¹è±¡ï¼ˆæœ¬ç« é‡ç‚¹ï¼Œè·å–å®ä¾‹ä¸­çš„å¯¹è±¡ï¼‰</strong></em></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">getObjectForBeanInstance</span><span class="params">(</span></span><br><span class="line"><span class="params">		Object beanInstance, String name, String beanName, <span class="meta">@Nullable</span> RootBeanDefinition mbd)</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 1. å¦‚æœæ˜¯å·¥å‚å¼•ç”¨(å³nameä»¥&amp;å¼€å¤´)ï¼Œä½†è¯¥å®ä¾‹åˆä¸æ˜¯FactoryBeanç±»å‹ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">	<span class="keyword">if</span> (BeanFactoryUtils.isFactoryDereference(name)) &#123;</span><br><span class="line">		<span class="keyword">if</span> (beanInstance <span class="keyword">instanceof</span> NullBean) &#123;</span><br><span class="line">			<span class="keyword">return</span> beanInstance;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!(beanInstance <span class="keyword">instanceof</span> FactoryBean)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanIsNotAFactoryException</span>(transformedBeanName(name), beanInstance.getClass());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 2. å¦‚æœè¯¥å®ä¾‹ä¸æ˜¯FactoryBeanç±»å‹ï¼Œæˆ–è€…æ˜¯å·¥å‚å¼•ç”¨éƒ½ç›´æ¥è¿”å›è¯¥å®ä¾‹</span></span><br><span class="line">	<span class="keyword">if</span> (!(beanInstance <span class="keyword">instanceof</span> FactoryBean) || BeanFactoryUtils.isFactoryDereference(name)) &#123;</span><br><span class="line">		<span class="keyword">return</span> beanInstance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">if</span> (mbd == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="comment">// å°è¯•ä»ç¼“å­˜ä¸­åŠ è½½bean</span></span><br><span class="line">		object = getCachedObjectForFactoryBean(beanName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (object == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="comment">// æŠŠåˆå§‹beanå®ä¾‹å¼ºè½¬ä¸ºFactoryBean</span></span><br><span class="line">		FactoryBean&lt;?&gt; factory = (FactoryBean&lt;?&gt;) beanInstance;</span><br><span class="line">		<span class="comment">// Caches object obtained from FactoryBean if it is a singleton.</span></span><br><span class="line">		<span class="keyword">if</span> (mbd == <span class="literal">null</span> &amp;&amp; containsBeanDefinition(beanName)) &#123;</span><br><span class="line">			mbd = getMergedLocalBeanDefinition(beanName);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">// æ˜¯å¦æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„beanDefinition(é»˜è®¤æ˜¯false)</span></span><br><span class="line">		<span class="type">boolean</span> <span class="variable">synthetic</span> <span class="operator">=</span> (mbd != <span class="literal">null</span> &amp;&amp; mbd.isSynthetic());</span><br><span class="line">		<span class="comment">// é‡ç‚¹æ–¹æ³•ï¼Œè·Ÿè¿›å»</span></span><br><span class="line">		object = getObjectFromFactoryBean(factory, beanName, !synthetic);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ä»FactoryBeanä¸­è·å–å¯¹è±¡ï¼šgetObjectFromFactoryBean()</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">getObjectFromFactoryBean</span><span class="params">(FactoryBean&lt;?&gt; factory, String beanName, <span class="type">boolean</span> shouldPostProcess)</span> &#123;</span><br><span class="line">	<span class="comment">// 1. å•ä¾‹æ¨¡å¼</span></span><br><span class="line">	<span class="keyword">if</span> (factory.isSingleton() &amp;&amp; containsSingleton(beanName)) &#123;</span><br><span class="line">		<span class="keyword">synchronized</span> (getSingletonMutex()) &#123;</span><br><span class="line">			<span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> <span class="built_in">this</span>.factoryBeanObjectCache.get(beanName);</span><br><span class="line">			<span class="keyword">if</span> (object == <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="comment">// çœŸæ­£è·å–å¯¹è±¡çš„æ–¹æ³•(é‡ç‚¹æ–¹æ³•)</span></span><br><span class="line">				object = doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">				<span class="comment">// Only post-process and store if not put there already during getObject() call above</span></span><br><span class="line">				<span class="comment">// (e.g. because of circular reference processing triggered by custom getBean calls)</span></span><br><span class="line">				<span class="type">Object</span> <span class="variable">alreadyThere</span> <span class="operator">=</span> <span class="built_in">this</span>.factoryBeanObjectCache.get(beanName);</span><br><span class="line">				<span class="keyword">if</span> (alreadyThere != <span class="literal">null</span>) &#123;</span><br><span class="line">					object = alreadyThere;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (shouldPostProcess) &#123;</span><br><span class="line">						<span class="keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">							<span class="comment">// Temporarily return non-post-processed object, not storing it yet..</span></span><br><span class="line">							<span class="keyword">return</span> object;</span><br><span class="line">						&#125;</span><br><span class="line">						beforeSingletonCreation(beanName);</span><br><span class="line">						<span class="keyword">try</span> &#123;</span><br><span class="line">							<span class="comment">// è°ƒç”¨beançš„åç½®å¤„ç†å™¨(æœ‰å…´è¶£çš„å¯ä»¥ç‚¹è¿›å»çœ‹ä¸‹ï¼Œåé¢çš„ç« èŠ‚ä¼šå•ç‹¬è®²è¿°)</span></span><br><span class="line">							object = postProcessObjectFromFactoryBean(object, beanName);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">							<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(beanName,</span><br><span class="line">									<span class="string">&quot;Post-processing of FactoryBean&#x27;s singleton object failed&quot;</span>, ex);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">finally</span> &#123;</span><br><span class="line">							afterSingletonCreation(beanName);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span> (containsSingleton(beanName)) &#123;</span><br><span class="line">						<span class="built_in">this</span>.factoryBeanObjectCache.put(beanName, object);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> object;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="comment">// 2. åŸå‹æ¨¡å¼</span></span><br><span class="line">		<span class="comment">// çœŸæ­£è·å–å¯¹è±¡çš„æ–¹æ³•(é‡ç‚¹æ–¹æ³•)</span></span><br><span class="line">		<span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> doGetObjectFromFactoryBean(factory, beanName);</span><br><span class="line">		<span class="keyword">if</span> (shouldPostProcess) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				object = postProcessObjectFromFactoryBean(object, beanName);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(beanName, <span class="string">&quot;Post-processing of FactoryBean&#x27;s object failed&quot;</span>, ex);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> object;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>çœŸæ­£ä»FactoryBeanä¸­è·å–å¯¹è±¡çš„é€»è¾‘ï¼šdoGetObjectFromFactoryBean()</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">doGetObjectFromFactoryBean</span><span class="params">(<span class="keyword">final</span> FactoryBean&lt;?&gt; factory, <span class="keyword">final</span> String beanName)</span></span><br><span class="line">		<span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line">	Object object;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// æƒé™éªŒè¯</span></span><br><span class="line">		<span class="keyword">if</span> (System.getSecurityManager() != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="type">AccessControlContext</span> <span class="variable">acc</span> <span class="operator">=</span> getAccessControlContext();</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				object = AccessController.doPrivileged((PrivilegedExceptionAction&lt;Object&gt;) factory::getObject, acc);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (PrivilegedActionException pae) &#123;</span><br><span class="line">				<span class="keyword">throw</span> pae.getException();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">// ç»ˆäºçœ‹åˆ°ä½ äº†ï¼</span></span><br><span class="line">			object = factory.getObject();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (FactoryBeanNotInitializedException ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName, ex.toString());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(beanName, <span class="string">&quot;FactoryBean threw exception on object creation&quot;</span>, ex);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Do not accept a null value for a FactoryBean that&#x27;s not fully</span></span><br><span class="line">	<span class="comment">// initialized yet: Many FactoryBeans just return null then.</span></span><br><span class="line">	<span class="keyword">if</span> (object == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(</span><br><span class="line">					beanName, <span class="string">&quot;FactoryBean which is currently in creation returned null from getObject&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		object = <span class="keyword">new</span> <span class="title class_">NullBean</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆå‘ç°å…¶å®è·å–å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±æ˜¯ä¸€è¡Œè°ƒç”¨FactoryBeançš„getObject()æ–¹æ³•ã€‚</p>
<h4 id="åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­æœ‰ä¸ªbeançš„å®ä¾‹åŒ–è¿‡ç¨‹æˆ‘ä»¬å¿…é¡»çŸ¥é“"><a href="#åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­æœ‰ä¸ªbeançš„å®ä¾‹åŒ–è¿‡ç¨‹æˆ‘ä»¬å¿…é¡»çŸ¥é“" class="headerlink" title="åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­æœ‰ä¸ªbeançš„å®ä¾‹åŒ–è¿‡ç¨‹æˆ‘ä»¬å¿…é¡»çŸ¥é“"></a>åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­æœ‰ä¸ªbeançš„å®ä¾‹åŒ–è¿‡ç¨‹æˆ‘ä»¬å¿…é¡»çŸ¥é“</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">createBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span></span><br><span class="line">      <span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">      logger.trace(<span class="string">&quot;Creating instance of bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">RootBeanDefinition</span> <span class="variable">mbdToUse</span> <span class="operator">=</span> mbd;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//æ¨æ–­å½“å‰Beandefinitionçš„beanClass</span></span><br><span class="line">   Class&lt;?&gt; resolvedClass = resolveBeanClass(mbd, beanName);</span><br><span class="line">   <span class="keyword">if</span> (resolvedClass != <span class="literal">null</span> &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != <span class="literal">null</span>) &#123;</span><br><span class="line">      mbdToUse = <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(mbd);</span><br><span class="line">      mbdToUse.setBeanClass(resolvedClass);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// å‡†å¤‡æ–¹æ³•é‡å†™ åŒ…æ‹¬lookup-methodå’Œreplaced-methodçš„å¤„ç†ï¼Œæœ¬æ–‡æš‚ä¸å±•å¼€</span></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      mbdToUse.prepareMethodOverrides();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (BeanDefinitionValidationException ex) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(mbdToUse.getResourceDescription(),</span><br><span class="line">            beanName, <span class="string">&quot;Validation of method overrides failed&quot;</span>, ex);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// ç¬¬ä¸€æ¬¡è°ƒç”¨åç½®å¤„ç†å™¨ï¼šåˆå§‹åŒ–Beanä¹‹å‰ï¼ŒInstantiationAwareBeanPostProcessor,</span></span><br><span class="line">      <span class="comment">// æ ¹æ®BeanDefinitionè·å–åˆ°äº†å¯¹åº”çš„classç±»</span></span><br><span class="line">      <span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> resolveBeforeInstantiation(beanName, mbdToUse);</span><br><span class="line">      <span class="keyword">if</span> (bean != <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> bean;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbdToUse.getResourceDescription(), beanName,</span><br><span class="line">            <span class="string">&quot;BeanPostProcessor before instantiation of bean failed&quot;</span>, ex);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//åˆ›å»ºBean</span></span><br><span class="line">      <span class="type">Object</span> <span class="variable">beanInstance</span> <span class="operator">=</span> doCreateBean(beanName, mbdToUse, args);</span><br><span class="line">      <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">         logger.trace(<span class="string">&quot;Finished creating instance of bean &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> beanInstance;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (BeanCreationException | ImplicitlyAppearedSingletonException ex) &#123;</span><br><span class="line">      <span class="comment">// A previously detected exception with proper bean creation context already,</span></span><br><span class="line">      <span class="comment">// or illegal singleton state to be communicated up to DefaultSingletonBeanRegistry.</span></span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">            mbdToUse.getResourceDescription(), beanName, <span class="string">&quot;Unexpected exception during bean creation&quot;</span>, ex);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>}</p>
<p>docreatebean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doCreateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span></span><br><span class="line">			<span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line"></span><br><span class="line">		<span class="type">BeanWrapper</span> <span class="variable">instanceWrapper</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">            <span class="comment">//ä»æœªå®Œæˆçš„ FactoryBean å®ä¾‹ä¸­ç§»é™¤</span></span><br><span class="line">			instanceWrapper = <span class="built_in">this</span>.factoryBeanInstanceCache.remove(beanName);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (instanceWrapper == <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="comment">//å®ä¾‹åŒ–å¯¹è±¡(ä»…ä»…æ˜¯ç”Ÿæˆå¯¹è±¡ï¼Œå¹¶éæ·»åŠ åˆ°springå•ä¾‹æ± ä¸­ï¼Œå³ç›®å‰å¹¶æ²¡æœ‰æˆä¸ºSpring Bean)ï¼Œ</span></span><br><span class="line">			<span class="comment">//å¹¶ä¸”ç¬¬äºŒæ¬¡è°ƒç”¨ åç½®å¤„ç†å™¨ determineConstructorsFromBeanPostProcessors</span></span><br><span class="line"> 			instanceWrapper = createBeanInstance(beanName, mbd, args);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="type">Object</span> <span class="variable">bean</span> <span class="operator">=</span> instanceWrapper.getWrappedInstance();</span><br><span class="line">		Class&lt;?&gt; beanType = instanceWrapper.getWrappedClass();</span><br><span class="line">		<span class="keyword">if</span> (beanType != NullBean.class) &#123;</span><br><span class="line">			mbd.resolvedTargetType = beanType;</span><br><span class="line">		&#125;</span><br><span class="line">    </span><br><span class="line"> 		... </span><br><span class="line">     	...  </span><br><span class="line">     	...   </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆé€šè¿‡createBeanInstanceæ–¹æ³•è°ƒç”¨åç½®å¤„ç†å™¨æ¨æ–­å…¶æ„é€ å‡½æ•°ï¼Œå¹¶åå°„åˆ›å»ºBeanDefinitionå¯¹åº”çš„å®ä¾‹ã€‚<strong>å®ä¾‹åŒ– Bean</strong></p>
<p><strong>æ³¨æ„æ­¤æ—¶åªæ˜¯åˆ›å»ºäº†ç±»å¯¹è±¡ï¼Œä½†è¿˜æ²¡æœ‰æ·»åŠ åˆ°Springçš„å•ä¾‹æ± ä¸­ï¼Œå³è¿˜æ²¡æœ‰åŠ å…¥åˆ°Springå®¹å™¨å†…éƒ¨ã€‚</strong><br><strong>å¯ä»¥ç†è§£ä¸ºæ­¤æ—¶åªæ˜¯å®Œæˆäº†ç±»å¯¹è±¡çš„å£°æ˜ï¼šå³ç±»ä¼¼äºA a&#x3D;null</strong></p>
<p>æ·»åŠ åˆ°Springçš„å•ä¾‹æ± æ˜¯åœ¨getSingletonï¼ˆï¼‰çš„addSingletonä¸­ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38289451/article/details/121965628">https://blog.csdn.net/qq_38289451/article/details/121965628</a></p>
<p>createBeanInstance() æ–¹æ³•æ˜¯ spring å®ä¾‹åŒ– bean çš„æ ¸å¿ƒä»£ç ï¼Œå®ƒæ ¹æ®ä¸åŒçš„æƒ…å†µä¼šè°ƒç”¨å››ç§å®ä¾‹åŒ–æ–¹æ³•</p>
<ul>
<li>obtainFromSupplier() ï¼šé€šè¿‡ Supplier å®ä¾‹åŒ–</li>
<li>instantiateUsingFactoryMethod()ï¼šé€šè¿‡å·¥å‚æ–¹æ³•å®ä¾‹åŒ–</li>
<li>autowireConstructor()ï¼šç”¨åˆé€‚çš„æ„é€ å‡½æ•°å®ä¾‹åŒ–</li>
<li>instantiateBean()ï¼šç”¨æ— å‚æ„é€ å‡½æ•°å®ä¾‹åŒ–</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) &#123;</span><br><span class="line">    </span><br><span class="line">	// ç¡®è®¤éœ€è¦åˆ›å»ºçš„beanå®ä¾‹çš„ç±»å¯ä»¥å®ä¾‹åŒ–</span><br><span class="line">	Class&lt;?&gt; beanClass = resolveBeanClass(mbd, beanName);</span><br><span class="line">	// ç¡®ä¿classä¸ä¸ºç©ºï¼Œå¹¶ä¸”è®¿é—®æƒé™æ˜¯public</span><br><span class="line">	if (beanClass != null &amp;&amp; !Modifier.isPublic(beanClass.getModifiers()) &amp;&amp; !mbd.isNonPublicAccessAllowed()) &#123;</span><br><span class="line">		throw new BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">				&quot;Bean class isn&#x27;t public, and non-public access not allowed: &quot; + beanClass.getName());</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * ----------1ï¼Œé€šè¿‡Supplierå®ä¾‹åŒ–------------</span><br><span class="line">	 */</span><br><span class="line">	Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier();</span><br><span class="line">	if (instanceSupplier != null) &#123;</span><br><span class="line">		return obtainFromSupplier(instanceSupplier, beanName);</span><br><span class="line">	&#125;</span><br><span class="line">    </span><br><span class="line">	/**</span><br><span class="line">	 * ----------2ï¼Œé€šè¿‡å·¥å‚æ–¹æ³•å®ä¾‹åŒ–------------</span><br><span class="line">	 */</span><br><span class="line">	if (mbd.getFactoryMethodName() != null) &#123;</span><br><span class="line">		return instantiateUsingFactoryMethod(beanName, mbd, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">	 * ----------3ï¼Œç”¨åˆé€‚çš„æ„é€ å‡½æ•°å®ä¾‹åŒ–------------</span><br><span class="line">	 *</span><br><span class="line">	 *  ä¸€ä¸ªç±»å¯èƒ½æœ‰å¤šä¸ªæ„é€ å™¨ï¼Œæ‰€ä»¥Springå¾—æ ¹æ®å‚æ•°ä¸ªæ•°ã€ç±»å‹ç¡®å®šéœ€è¦è°ƒç”¨çš„æ„é€ å™¨ã€‚</span><br><span class="line">	 *  åœ¨ä½¿ç”¨æ„é€ å™¨åˆ›å»ºå®ä¾‹åï¼ŒSpringä¼šå°†è§£æè¿‡åç¡®å®šä¸‹æ¥çš„æ„é€ å™¨æˆ–å·¥å‚æ–¹æ³•ä¿å­˜åœ¨ç¼“å­˜ä¸­ï¼Œ</span><br><span class="line">	 *  é¿å…å†æ¬¡åˆ›å»ºç›¸åŒbeanæ—¶å†æ¬¡è§£æ</span><br><span class="line">	 */</span><br><span class="line">	// æ ‡è®°ä¸‹ï¼Œé˜²æ­¢é‡å¤åˆ›å»ºåŒä¸€ä¸ªbean</span><br><span class="line">	boolean resolved = false;</span><br><span class="line">	// æ˜¯å¦éœ€è¦è‡ªåŠ¨è£…é…ï¼Œæ„é€ æœ‰å‚æ•°çš„éœ€è¦</span><br><span class="line">	boolean autowireNecessary = false;</span><br><span class="line">	// å¦‚æœæ²¡æœ‰å‚æ•°</span><br><span class="line">	if (args == null) &#123;</span><br><span class="line">		synchronized (mbd.constructorArgumentLock) &#123;</span><br><span class="line">			// ä¸€ä¸ªç±»ä¸­æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸åŒçš„å‚æ•°ï¼Œæ‰€ä»¥è°ƒç”¨å‰éœ€è¦å…ˆæ ¹æ®å‚æ•°é”å®šæ„é€ å‡½æ•°æˆ–å¯¹åº”çš„å·¥å‚æ–¹æ³•</span><br><span class="line">			if (mbd.resolvedConstructorOrFactoryMethod != null) &#123;</span><br><span class="line">				resolved = true;</span><br><span class="line">				autowireNecessary = mbd.constructorArgumentsResolved;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	// æœ‰æ„é€ å‚æ•°çš„æˆ–è€…å·¥å‚æ–¹æ³•</span><br><span class="line">	if (resolved) &#123;</span><br><span class="line">		// æ„é€ å™¨æœ‰å‚æ•°</span><br><span class="line">		if (autowireNecessary) &#123;</span><br><span class="line">			// æ„é€ å‡½æ•°è‡ªåŠ¨æ³¨å…¥</span><br><span class="line">			return autowireConstructor(beanName, mbd, null, null);</span><br><span class="line">		&#125;</span><br><span class="line">		else &#123;</span><br><span class="line">			// ä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°æ„é€ </span><br><span class="line">			return instantiateBean(beanName, mbd);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// ä»beanåç½®å¤„ç†å™¨ä¸­ä¸ºè‡ªåŠ¨è£…é…å¯»æ‰¾æ„é€ æ–¹æ³•</span><br><span class="line">	Constructor&lt;?&gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);</span><br><span class="line">	if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||</span><br><span class="line">			mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) &#123;</span><br><span class="line">		return autowireConstructor(beanName, mbd, ctors, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// æ‰¾å‡ºæœ€åˆé€‚çš„é»˜è®¤æ„é€ æ–¹æ³•</span><br><span class="line">	ctors = mbd.getPreferredConstructors();</span><br><span class="line">	if (ctors != null) &#123;</span><br><span class="line">		// æ„é€ å‡½æ•°è‡ªåŠ¨æ³¨å…¥</span><br><span class="line">		return autowireConstructor(beanName, mbd, ctors, null);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">	 * ----------4ï¼Œä½¿ç”¨é»˜è®¤æ„é€ å‡½æ•°æ„é€ ------------</span><br><span class="line">	 */</span><br><span class="line">	return instantiateBean(beanName, mbd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="æ–°å¢ObjectFactoryåˆ°ç¬¬ä¸‰çº§ç¼“å­˜"><a href="#æ–°å¢ObjectFactoryåˆ°ç¬¬ä¸‰çº§ç¼“å­˜" class="headerlink" title="æ–°å¢ObjectFactoryåˆ°ç¬¬ä¸‰çº§ç¼“å­˜"></a>æ–°å¢ObjectFactoryåˆ°ç¬¬ä¸‰çº§ç¼“å­˜</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protected Object doCreateBean(String beanName, RootBeanDefinition mbd, @Nullable Object[] args)</span><br><span class="line">    	throws BeanCreationException &#123;</span><br><span class="line">        ...</span><br><span class="line">        ...</span><br><span class="line">        //å…è®¸åç½®å¤„ç†å™¨é‡æ–°å®šä¹‰beanDefinition</span><br><span class="line">		synchronized (mbd.postProcessingLock) &#123;</span><br><span class="line">			if (!mbd.postProcessed) &#123;</span><br><span class="line">				try &#123;</span><br><span class="line">					//ç¬¬ä¸‰æ¬¡è°ƒç”¨åç½®å¤„ç†å™¨ MergedBeanDefinitionPostProcessors</span><br><span class="line">					applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</span><br><span class="line">				&#125;</span><br><span class="line">				catch (Throwable ex) &#123;</span><br><span class="line">					throw new BeanCreationException(mbd.getResourceDescription(), beanName,</span><br><span class="line">							&quot;Post-processing of merged bean definition failed&quot;, ex);</span><br><span class="line">				&#125;</span><br><span class="line">				mbd.postProcessed = true;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		//åˆ¤æ–­æ˜¯å¦å…è®¸å¾ªç¯ä¾èµ–ï¼Œé»˜è®¤æ˜¯å…è®¸çš„ï¼Œå¯ä»¥é€šè¿‡ä»£ç ä¿®æ”¹çš„ä¸€èˆ¬åªæœ‰allowCircularReferencesçš„å€¼</span><br><span class="line">		boolean earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp;</span><br><span class="line">				isSingletonCurrentlyInCreation(beanName));</span><br><span class="line">		if (earlySingletonExposure) &#123;</span><br><span class="line">			if (logger.isTraceEnabled()) &#123;</span><br><span class="line">				logger.trace(&quot;Eagerly caching bean &#x27;&quot; + beanName +</span><br><span class="line">						&quot;&#x27; to allow for resolving potential circular references&quot;);</span><br><span class="line">			&#125;</span><br><span class="line">			// getEarlyBeanReferenceé‡Œé¢åŒ…å«äº†åˆä¸€æ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨ï¼ŒSmartInstantiationAwareBeanPostProcessor </span><br><span class="line">			addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="å±æ€§å¡«å……ï¼špopulateBean"><a href="#å±æ€§å¡«å……ï¼špopulateBean" class="headerlink" title="å±æ€§å¡«å……ï¼špopulateBean"></a>å±æ€§å¡«å……ï¼špopulateBean</h4><p>ç„¶ååšä¸€äº›å¤„ç†æ¯”å¦‚å¾ªç¯ä¾èµ–ç­‰ï¼Œç›´åˆ°çœ‹åˆ°populateBean(beanName, mbd, instanceWrapper);è¿™ä¸ªä»£ç ï¼Œè¿™ä¸€æ­¥è´Ÿè´£å±æ€§è£…é…ï¼Œå¾ˆé‡è¦ï¼Œå› ä¸ºå‰é¢çš„å®ä¾‹åªæ˜¯å®ä¾‹åŒ–äº†ï¼Œå¹¶æ²¡æœ‰è®¾å€¼ï¼Œè¿™é‡Œå°±æ˜¯è®¾å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doCreateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> Object[] args)</span></span><br><span class="line">    <span class="keyword">throws</span> BeanCreationException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize the bean instance.</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">exposedObject</span> <span class="operator">=</span> bean;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//å¡«å……å±æ€§ï¼ˆå³è‡ªåŠ¨æ³¨å…¥ï¼‰ å®Œæˆç¬¬äº”æ¬¡å’Œç¬¬å…­æ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨</span></span><br><span class="line">        <span class="comment">// InstantiationAwareBeanPostProcessor.after</span></span><br><span class="line">        <span class="comment">// hasInstantiationAwareBeanPostProcessors</span></span><br><span class="line">        populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">        <span class="comment">//å®Œæˆç¬¬ä¸ƒæ¬¡å’Œç¬¬å…«æ¬¡åç½®å¤„ç†å™¨çš„è°ƒç”¨ï¼Œ</span></span><br><span class="line">        <span class="comment">//åˆ¤æ–­å½“å‰Beanï¼Œæ˜¯å¦æ˜¯BeanNameAwareã€BeanClassLoaderAwareã€BeanFactoryAwareå¹¶åˆ†åˆ«è®¾ç½®ç›¸å…³å†…å®¹</span></span><br><span class="line">        <span class="comment">//applyBeanPostProcessorsAfterInitialization</span></span><br><span class="line">        <span class="comment">//applyBeanPostProcessorsAfterInitialization</span></span><br><span class="line">        exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ex <span class="keyword">instanceof</span> BeanCreationException &amp;&amp; beanName.equals(((BeanCreationException) ex).getBeanName())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> (BeanCreationException) ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">                mbd.getResourceDescription(), beanName, <span class="string">&quot;Initialization of bean failed&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">populateBeanæ–¹æ³•å®Œæˆå±æ€§å¡«å……ï¼Œè·Ÿè¿›</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">populateBean</span><span class="params">(String beanName, RootBeanDefinition mbd, <span class="meta">@Nullable</span> BeanWrapper bw)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (bw == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mbd.hasPropertyValues()) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(</span><br><span class="line">               mbd.getResourceDescription(), beanName, <span class="string">&quot;Cannot apply property values to null instance&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="comment">// Skip property population phase for null instance.</span></span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//åœ¨è®¾ç½®å±æ€§ä¹‹å‰ï¼Œè®©ä»»ä½• InstantiationAwareBeanPostProcessors æœ‰æœºä¼šä¿®æ”¹ bean çš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œè¿™å¯ç”¨äºæ”¯æŒå­—æ®µæ³¨å…¥æ ·å¼ã€‚</span></span><br><span class="line">  <span class="comment">//æ‰©å±•ç‚¹ï¼Œåˆä¸€æ¬¡è°ƒç”¨åç½®å¤„ç†å™¨ï¼Œ</span></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">continueWithPropertyPopulation</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!mbd.isSynthetic() &amp;&amp; hasInstantiationAwareBeanPostProcessors()) &#123;</span><br><span class="line">      <span class="keyword">for</span> (BeanPostProcessor bp : getBeanPostProcessors()) &#123;</span><br><span class="line">         <span class="keyword">if</span> (bp <span class="keyword">instanceof</span> InstantiationAwareBeanPostProcessor) &#123;</span><br><span class="line">            <span class="type">InstantiationAwareBeanPostProcessor</span> <span class="variable">ibp</span> <span class="operator">=</span> (InstantiationAwareBeanPostProcessor) bp;</span><br><span class="line">            <span class="keyword">if</span> (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) &#123;</span><br><span class="line">               continueWithPropertyPopulation = <span class="literal">false</span>;</span><br><span class="line">               <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (!continueWithPropertyPopulation) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="comment">//å¦‚æœåç½®å¤„ç†å™¨ä¿®æ”¹äº†Beandefinitionï¼Œåˆ™åˆ¤æ–­æ˜¯å¦å·²ç»ä¿®æ”¹è¿‡äº†å±æ€§å€¼çš„ç›¸å…³é…ç½®</span></span><br><span class="line">   <span class="comment">//å¦‚æœä¿®æ”¹äº†ï¼Œåˆ™æŒ‰ç…§å™¨byNameæˆ–byTypeçš„æ–¹å¼ç›´æ¥å®Œæˆè£…è½½</span></span><br><span class="line">   <span class="type">PropertyValues</span> <span class="variable">pvs</span> <span class="operator">=</span> (mbd.hasPropertyValues() ? mbd.getPropertyValues() : <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (mbd.getResolvedAutowireMode() == AUTOWIRE_BY_NAME || mbd.getResolvedAutowireMode() == AUTOWIRE_BY_TYPE) &#123;</span><br><span class="line">      <span class="type">MutablePropertyValues</span> <span class="variable">newPvs</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MutablePropertyValues</span>(pvs);</span><br><span class="line">      <span class="comment">// Add property values based on autowire by name if applicable.</span></span><br><span class="line">      <span class="keyword">if</span> (mbd.getResolvedAutowireMode() == AUTOWIRE_BY_NAME) &#123;</span><br><span class="line">         autowireByName(beanName, mbd, bw, newPvs);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// Add property values based on autowire by type if applicable.</span></span><br><span class="line">      <span class="keyword">if</span> (mbd.getResolvedAutowireMode() == AUTOWIRE_BY_TYPE) &#123;</span><br><span class="line">         autowireByType(beanName, mbd, bw, newPvs);</span><br><span class="line">      &#125;</span><br><span class="line">      pvs = newPvs;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="type">boolean</span> <span class="variable">hasInstAwareBpps</span> <span class="operator">=</span> hasInstantiationAwareBeanPostProcessors();</span><br><span class="line">   <span class="type">boolean</span> <span class="variable">needsDepCheck</span> <span class="operator">=</span> (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);</span><br><span class="line"></span><br><span class="line">   [] filteredPds = <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">if</span> (hasInstAwareBpps) &#123;</span><br><span class="line">      <span class="keyword">if</span> (pvs == <span class="literal">null</span>) &#123;</span><br><span class="line">         pvs = mbd.getPropertyValues();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (BeanPostProcessor bp : getBeanPostProcessors()) &#123;</span><br><span class="line">         <span class="keyword">if</span> (bp <span class="keyword">instanceof</span> InstantiationAwareBeanPostProcessor) &#123;</span><br><span class="line">            <span class="type">InstantiationAwareBeanPostProcessor</span> <span class="variable">ibp</span> <span class="operator">=</span> (InstantiationAwareBeanPostProcessor) bp;</span><br><span class="line">            <span class="comment">//åˆ©ç”¨åç½®å¤„ç†å™¨ï¼Œå¤„ç†å±æ€§çš„è·å–</span></span><br><span class="line">            <span class="type">PropertyValues</span> <span class="variable">pvsToUse</span> <span class="operator">=</span> ibp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);</span><br><span class="line">            <span class="keyword">if</span> (pvsToUse == <span class="literal">null</span>) &#123;</span><br><span class="line">               <span class="keyword">if</span> (filteredPds == <span class="literal">null</span>) &#123;</span><br><span class="line">                  filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);</span><br><span class="line">               &#125;</span><br><span class="line">               pvsToUse = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName);</span><br><span class="line">               <span class="keyword">if</span> (pvsToUse == <span class="literal">null</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span>;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            pvs = pvsToUse;</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (needsDepCheck) &#123;</span><br><span class="line">      <span class="keyword">if</span> (filteredPds == <span class="literal">null</span>) &#123;</span><br><span class="line">         filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);</span><br><span class="line">      &#125;</span><br><span class="line">      checkDependencies(beanName, mbd, filteredPds, pvs);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (pvs != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">//æ ¹æ®PropertyValueså®Œæˆå±æ€§å¡«å……</span></span><br><span class="line">      applyPropertyValues(beanName, mbd, bw, pvs);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>populateBeané‡Œé¢å†æ¬¡è°ƒç”¨åç½®å¤„ç†å™¨ï¼Œspringåœ¨è¿™é‡Œæä¾›äº†ä¸€ä¸ªæ‰©å±•ç‚¹ï¼Œå…è®¸å¼€å‘è€…åœ¨å±æ€§å¡«å……è¿™ä¸ªé˜¶æ®µä¿®æ”¹Beançš„çŠ¶æ€ï¼ˆä½¿ç”¨åç½®å¤„ç†å™¨çš„æ–¹å¼ï¼‰ã€‚å¹¶ä¸”å¯èƒ½ç›´æ¥ä¾æ®byNameå’ŒbyTypeè£…è½½å±æ€§å€¼ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨è‡ªåŠ¨è£…è½½è¿™ä¸€åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Autowiredå’Œ@Resourceã€‚è¿™ä¸¤ä¸ªæ³¨è§£çš„åŠŸèƒ½ä¹Ÿä¸ä¸€æ ·ã€‚é‚£ä¹ˆè§£æçš„æ–¹å¼ä¹Ÿåº”å½“ä¸ä¸€æ ·ã€‚</p>
<h3 id="factorybeanå’Œbeanfactory"><a href="#factorybeanå’Œbeanfactory" class="headerlink" title="factorybeanå’Œbeanfactory"></a>factorybeanå’Œbeanfactory</h3><p>åœ¨æˆ‘ä»¬çš„å¼€å‘å·¥ä½œä¸­åº”è¯¥éƒ½è§è¿‡æˆ–ä½¿ç”¨è¿‡FactoryBeanè¿™ä¸ªç±»ï¼Œä¹Ÿè®¸ä½ ä¼šçœ‹æˆäº†BeanFactoryè¿™ä¸ªç±»ã€‚FactoryBeanå’ŒBeanFactoryè™½ç„¶é•¿çš„å¾ˆåƒï¼Œä½†æ˜¯ä»–ä»¬çš„ä½œç”¨ç¡®å®å®Œå…¨ä¸åƒã€‚è¿™é‡Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œä½ ä¼šåœ¨ä»€ä¹ˆæ ·çš„åœºæ™¯ä¸‹ä½¿ç”¨FactoryBeanè¿™ä¸ªæ¥å£ï¼ŸFactoryBeanæ˜¯ä¸€ä¸ªå·¥å‚Beanï¼Œå¯ä»¥ç”ŸæˆæŸä¸€ä¸ªç±»å‹Beanå®ä¾‹ï¼Œå®ƒæœ€å¤§çš„ä¸€ä¸ªä½œç”¨æ˜¯ï¼šå¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰Beançš„åˆ›å»ºè¿‡ç¨‹ã€‚BeanFactoryæ˜¯Springå®¹å™¨ä¸­çš„ä¸€ä¸ªåŸºæœ¬ç±»ä¹Ÿæ˜¯å¾ˆé‡è¦çš„ä¸€ä¸ªç±»ï¼Œåœ¨BeanFactoryä¸­å¯ä»¥åˆ›å»ºå’Œç®¡ç†Springå®¹å™¨ä¸­çš„Beanï¼Œå®ƒå¯¹äºBeançš„åˆ›å»ºæœ‰ä¸€ä¸ªç»Ÿä¸€çš„æµç¨‹ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹FactoryBeanä¸­æœ‰ä»€ä¹ˆä¸œè¥¿ï¼š</p>
<p>èƒŒæ™¯<br>å‡è®¾æˆ‘ä»¬æœ‰è¿™ç§éœ€æ±‚ï¼ŒåƒMybaitséœ€è¦å°†è¿™äº›æ¥å£æ³¨å…¥åˆ°Springå®¹å™¨ä¸­</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public interface OneTestDao &#123;</span><br><span class="line">    @Select(&quot;SELECT name FROM user WHERE id = 1&quot;)</span><br><span class="line">    String query();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface TwoTestDao &#123;</span><br><span class="line">    @Select(&quot;SELECT name FROM user WHERE id = 2&quot;)</span><br><span class="line">    String query();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆæˆ‘ä»¬æƒ³å°†æˆ‘ä»¬çš„è‡ªå·±çš„Bean(æ¯”å¦‚ä»£ç†å¯¹è±¡)æ³¨å…¥åˆ°Springå®¹å™¨ä¸­ï¼Œæœ‰ä»€ä¹ˆæ–¹å¼å‘¢ï¼Ÿ</p>
<p>ä¸€èˆ¬éƒ½æ˜¯é€šè¿‡Springæ‰«æResouceèµ„æºç„¶åè§£æä¸ºBeanDefinitionï¼Œæ‰èƒ½ä»getBeanæ—¶è§£æBeanDefinitionå®ä¾‹åŒ–å¯¹è±¡æ”¾å…¥æ­¤å•ä¾‹ç¼“å­˜ä¸­.ä½†æ˜¯æˆ‘ä»¬è¿™é‡Œçš„æ˜¯æ¥å£ï¼Œæ²¡æ³•ç›´æ¥æ³¨å…¥åˆ°Springå®¹å™¨ä¸­ã€‚</p>
<p>ä¸è¿‡Springæä¾›äº†ä¸€äº›æ‰©å±•æ¥å£æ¥ä¾›æˆ‘ä»¬åœ¨BeanåŠ è½½ã€åˆå§‹åŒ–ã€åŠ è½½å®Œæä¾›äº†ä¸€äº›æ¥å£ï¼Œä¾›æˆ‘ä»¬æ‰©å±•ã€‚<br>æ¯”å¦‚BeanFactoryPostProcessor</p>
<p>ä»æµ‹è¯•ç»“æœä¸­å¾—çŸ¥ï¼Œæˆ‘ä»¬è™½ç„¶é…ç½®çš„æ˜¯<code>MapperFactoryBean</code>çš„å®åˆ—ï¼Œä½†æ˜¯æ ¹æ®idæ‹¿åˆ°çš„æ˜¯<code>getObject</code>æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡ã€‚å…¶å®åœ¨å®¹å™¨ä¸­åˆ›å»ºçš„å¯¹è±¡ä»ç„¶æ˜¯<code>MapperFactoryBean</code>çš„å®åˆ—ï¼Œåªæ˜¯åœ¨è·å–çš„æ—¶å€™ä¼šåˆ¤æ–­è¿™ä¸ªç»“æœå¯¹è±¡æ˜¯ä¸æ˜¯æ´¾ç”Ÿäº<code>FactoryBean</code>ï¼Œå¦‚æœæ˜¯çš„è¯åˆ™è¿”å›<code>getObject</code>æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿™ä¸ªå¯¹è±¡å¹¶ä¸æ˜¯å®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºçš„ï¼Œè€Œæ˜¯ä½¿ç”¨<code>context.getBean()</code>æ–¹æ³•æ—¶æ‰åˆ›å»ºã€‚å½“ç„¶äº†ï¼Œå¦‚æœä½ ç¡®å®æƒ³è¦è·å–<code>FactoryBean</code>å®ä¾‹ï¼Œä½ éœ€è¦è¿™æ ·å†™: <em><code>MapperFactoryBean mapper = context.getBean(&quot;&amp;mapper&quot;, MapperFactoryBean.class);</code></em> åªéœ€è¦åœ¨beançš„åå­—IDå‰åŠ ä¸Š&amp;ç¬¦å·ã€‚</p>
<p>éå¸¸é‡è¦ï¼šæƒ³çŸ¥é“factoryæµç¨‹ï¼Œè¯·ç»“åˆ</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_30881367/article/details/98567729?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=mapperfactorybean%E7%9A%84%E4%BD%9C%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-98567729.nonecase&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/weixin_30881367/article/details/98567729?ops_request_misc=&amp;request_id=&amp;biz_id=102&amp;utm_term=mapperfactorybean%E7%9A%84%E4%BD%9C%E7%94%A8&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-3-98567729.nonecase&amp;spm=1018.2226.3001.4187</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Roger_CX/article/details/120739214?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168111515116800192294702%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168111515116800192294702&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-120739214-null-null.142%5Ev82%5Ekoosearch_v1,201%5Ev4%5Eadd_ask,239%5Ev2%5Einsert_chatgpt&amp;utm_term=FactoryBean%E4%BD%9C%E7%94%A8&amp;spm=1018.2226.3001.4187">https://blog.csdn.net/Roger_CX/article/details/120739214?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168111515116800192294702%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=168111515116800192294702&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-120739214-null-null.142^v82^koosearch_v1,201^v4^add_ask,239^v2^insert_chatgpt&amp;utm_term=FactoryBean%E4%BD%9C%E7%94%A8&amp;spm=1018.2226.3001.4187</a></p>
<p><strong>FactoryBeanæ˜¯ä¸€ä¸ªèƒ½ç”Ÿäº§æˆ–ä¿®é¥°å¯¹è±¡ç”Ÿæˆçš„å·¥å‚Bean</strong>ã€‚ä¸€ä¸ªBeanå¦‚æœå®ç°äº†FactoryBeanæ¥å£ï¼Œé‚£ä¹ˆ<strong>æ ¹æ®è¯¥Beançš„åç§°è·å–åˆ°çš„å®é™…ä¸Šæ˜¯getObjectè¿”å›çš„å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯è¿™ä¸ªBeanè‡ªèº«å®ä¾‹ï¼Œå¦‚æœ<strong>è¦è·å–è¿™ä¸ªBeanè‡ªèº«å®ä¾‹ï¼Œé‚£ä¹ˆéœ€è¦åœ¨åç§°å‰é¢åŠ ä¸Šâ€™&amp;â€™ç¬¦å·</strong>ã€‚</p>
<p>åˆ›å»ºbeançš„ä¸¤ç§æ–¹å¼ï¼š</p>
<p>ç¬¬ä¸€ç§ï¼Œå•ä¾‹åœ¨Springå®¹å™¨åˆå§‹åŒ–ä¹‹å‰ï¼Œ å°±å·²ç»åˆ›å»ºäº†beanï¼Œä¸”æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ªã€‚</p>
<p>ç¬¬äºŒç§ï¼Œå¤šä¾‹åœ¨ç”¨åˆ°å¯¹è±¡çš„æ—¶å€™ï¼Œæ‰åˆ›å»ºå¯¹è±¡ï¼Œå½“æˆ‘ä»¬åœ¨Aç±»ä¸­éœ€è¦ç”¨åˆ°Bç±»æ—¶ï¼Œé€šè¿‡@Autowiredæ³¨è§£æ³¨å…¥ç”¨åˆ°æ—¶ã€‚</p>

      
       <hr><span style="font-style: italic;color: gray;"> è½¬è½½è¯·æ³¨æ˜æ¥æºï¼Œæ¬¢è¿å¯¹æ–‡ç« ä¸­çš„å¼•ç”¨æ¥æºè¿›è¡Œè€ƒè¯ï¼Œæ¬¢è¿æŒ‡å‡ºä»»ä½•æœ‰é”™è¯¯æˆ–ä¸å¤Ÿæ¸…æ™°çš„è¡¨è¾¾ã€‚å¯ä»¥åœ¨ä¸‹é¢è¯„è®ºåŒºè¯„è®ºï¼Œä¹Ÿå¯ä»¥é‚®ä»¶è‡³ caosen0819@163.com </span>
    </div>
</article>







    




    </div>
    <div class="copyright">
        <p class="footer-entry">
    Â©2017 CSEN
</p>
<p class="footer-entry">Built with <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/yelog/hexo-theme-3-hexo" target="_blank">3-hexo</a> theme</p>

    </div>
    <div class="full-toc">
        <button class="full" data-title="åˆ‡æ¢å…¨å± å¿«æ·é”® s"><span class="min "></span></button>
<a class="" id="rocket" ></a>

    </div>
</div>

</body>
<script src="/js/jquery.pjax.js?v=1.1.0" ></script>

<script src="/js/script.js?v=1.1.0" ></script>
<script>
    var img_resize = 'default';
    function initArticle() {
        /*æ¸²æŸ“å¯¹åº”çš„è¡¨æ ¼æ ·å¼*/
        
            $("#post .pjax table").addClass("green_title");
        

        /*æ¸²æŸ“æ‰“èµæ ·å¼*/
        

        /*é«˜äº®ä»£ç å—è¡Œå·*/
        

        /*è®¿é—®æ•°é‡*/
        
        $.getScript("//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js");
        

        /*ä»£ç é«˜äº®ï¼Œè¡Œå·å¯¹é½*/
        $('.pre-numbering').css('line-height',$('.has-numbering').css('line-height'));

        
        
    }

    /*æ‰“èµé¡µé¢éšè—ä¸å±•ç¤º*/
    

</script>

<!--åŠ å…¥è¡Œå·çš„é«˜äº®ä»£ç å—æ ·å¼-->

<!--è‡ªå®šä¹‰æ ·å¼è®¾ç½®-->
<style>
    
    
    .nav {
        width: 542px;
    }
    .nav.fullscreen {
        margin-left: -542px;
    }
    .nav-left {
        width: 120px;
    }
    
    
    @media screen and (max-width: 1468px) {
        .nav {
            width: 492px;
        }
        .nav.fullscreen {
            margin-left: -492px;
        }
        .nav-left {
            width: 100px;
        }
    }
    
    
    @media screen and (max-width: 1024px) {
        .nav {
            width: 492px;
            margin-left: -492px
        }
        .nav.fullscreen {
            margin-left: 0;
        }
    }
    
    @media screen and (max-width: 426px) {
        .nav {
            width: 100%;
        }
        .nav-left {
            width: 100%;
        }
    }
    
    
    .nav-right .title-list nav a .post-title, .nav-right .title-list #local-search-result a .post-title {
        color: #383636;
    }
    
    
    .nav-right .title-list nav a .post-date, .nav-right .title-list #local-search-result a .post-date {
        color: #5e5e5f;
    }
    
    
    .nav-right nav a.hover, #local-search-result a.hover{
        background-color: #e2e0e0;
    }
    
    

    /*åˆ—è¡¨æ ·å¼*/
    

    /* èƒŒæ™¯å›¾æ ·å¼ */
    
    


    /*å¼•ç”¨å—æ ·å¼*/
    

    /*æ–‡ç« åˆ—è¡¨èƒŒæ™¯å›¾*/
    

    
</style>







</html>
